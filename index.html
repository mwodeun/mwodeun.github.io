<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="utf-8">
<title>MWODEUN ëª¨ë“ ê²½ë§¤</title>

<style>
body{font-family:Arial,sans-serif;margin:0;background:#f5f5f5;}
header{text-align:center;padding:30px 0 10px;background:white;}

nav{background:#222;padding:10px;display:flex;flex-wrap:wrap;justify-content:center;}
nav a{color:white;margin:10px;text-decoration:none;font-size:14px;}
nav a:hover{color:#6a0dad;}

.container{max-width:1100px;margin:40px auto;padding:0 20px;}
h2{margin:0 0 14px;}
.sectionTitle{display:flex;align-items:center;justify-content:space-between;gap:10px;margin:22px 0 12px;}
.sectionTitle h3{margin:0;font-size:16px;}
.pill{font-size:12px;font-weight:900;padding:6px 10px;border-radius:999px;background:#eee;color:#111;}
.pill.purple{background:#f1e6ff;color:#4b0aa0;border:1px solid #ead7ff;}
.pill.gray{background:#f0f0f0;color:#444;border:1px solid #ddd;}

.cards{display:flex;gap:25px;flex-wrap:wrap;justify-content:center;}

.card{
  background:white;width:300px;padding:20px;border-radius:12px;
  box-shadow:0 8px 20px rgba(0,0,0,0.08);
  transition:0.2s;overflow:hidden;position:relative;
}
.card:hover{transform:translateY(-5px);}

.card img{width:100%;height:180px;object-fit:cover;border-radius:10px;margin-bottom:12px;display:block;}
.card h3{margin:0 0 10px;font-size:18px;}

.meta{display:flex;justify-content:space-between;gap:10px;align-items:center;margin-bottom:6px;}
.price{font-size:16px;font-weight:900;}
.bids{font-size:13px;color:#555;}
.remain{font-size:14px;color:#d40000;margin-bottom:12px;}

button{
  padding:8px 14px;background:#6a0dad;color:white;border:none;border-radius:6px;cursor:pointer;
}
button:hover{background:#5300a8;}
.btn-gray{background:#eee;color:#111;}
.btn-gray:hover{background:#e0e0e0;}
.btn-small{
  padding:6px 10px;
  font-size:12px;
  border-radius:8px;
}
.btn-danger{background:#d40000;}
.btn-danger:hover{background:#b10000;}

.cardTopBar{
  display:flex;align-items:center;justify-content:space-between;gap:10px;margin-bottom:10px;
}
.adminTools{
  display:flex;gap:8px;align-items:center;
}
.adminTag{
  font-size:11px;font-weight:900;
  padding:5px 8px;border-radius:999px;
  background:#fff4e6;border:1px solid #ffd7a8;color:#8a4b00;
}

/* ë§ˆê° ì¹´ë“œ ìŠ¤íƒ€ì¼ */
.card.closed{
  opacity:0.92;
}
.closedBadge{
  position:absolute;left:14px;top:14px;
  background:rgba(0,0,0,0.75);
  color:white;
  font-size:12px;
  font-weight:900;
  padding:6px 10px;
  border-radius:999px;
}

/* âœ… í•„í„° ìƒíƒœ í‘œì‹œ */
.filterbar{
  display:flex;justify-content:space-between;align-items:center;gap:10px;
  background:white;border-radius:10px;padding:12px 14px;
  box-shadow:0 6px 16px rgba(0,0,0,0.06);
  margin:14px 0 10px;
  font-size:14px;
}
.badge{display:inline-block;padding:6px 10px;background:#f1e6ff;border-radius:999px;color:#4b0aa0;font-weight:900;}
.linkbtn{color:#6a0dad;cursor:pointer;font-weight:900;text-decoration:underline;}
.small{color:#666;}
.hint{margin:0 0 14px;font-size:13px;color:#666;line-height:1.45;}

/* âœ… ëª¨ë‹¬ ê³µí†µ */
.modal-bg{
  position:fixed;left:0;top:0;width:100%;height:100%;
  background:rgba(0,0,0,0.55);display:none;align-items:center;justify-content:center;
  z-index:9999;padding:20px;
}
.modal{
  width:100%;max-width:480px;background:white;border-radius:14px;
  box-shadow:0 12px 35px rgba(0,0,0,0.25);overflow:hidden;
}
.modal-header{
  display:flex;justify-content:space-between;align-items:center;
  padding:14px 16px;background:#6a0dad;color:white;
}
.modal-title{font-size:16px;font-weight:900;}
.modal-close{background:transparent;border:none;color:white;font-size:22px;cursor:pointer;padding:0 6px;}
.modal-body{padding:16px;}
.modal-row{margin-bottom:10px;font-size:14px;}
.modal-row b{display:inline-block;width:92px;}
.modal-input{
  width:100%;padding:10px 12px;border:1px solid #ddd;border-radius:10px;
  font-size:14px;box-sizing:border-box;margin:8px 0 12px;
}
.modal-actions{display:flex;gap:10px;justify-content:flex-end;padding:0 16px 16px;}
.notice{
  background:#faf5ff;border:1px solid #ead7ff;color:#4b0aa0;
  padding:10px 12px;border-radius:10px;font-size:13px;margin-top:10px;line-height:1.45;
}
.grid2{display:grid;grid-template-columns:1fr 1fr;gap:10px;}
label{font-size:13px;font-weight:900;}

/* ë³´ì¦ê¸ˆ ì²´í¬ */
.checkRow{
  display:flex;gap:10px;align-items:flex-start;
  background:#fff8ea;border:1px solid #ffe1b8;color:#8a4b00;
  padding:10px 12px;border-radius:10px;margin-top:8px;
  font-size:13px;line-height:1.4;
}
.checkRow input{margin-top:2px;}
.hr{height:1px;background:#eee;margin:18px 0;}
</style>
</head>

<body>

<header>
  <img src="logo.png" alt="MWODEUN ëª¨ë“ ê²½ë§¤" style="height:90px;">
  <div style="font-size:22px; font-weight:700; margin-top:10px;">ëª¨ë“ ê²½ë§¤</div>
</header>

<nav>
  <a href="#">ğŸ“º ê°€ì „ì œí’ˆ</a>
  <a href="#">ğŸ— ê±´ì„¤ ì”ì—¬ìì¬</a>
  <a href="#">ğŸ’¥ ê³ ì¥&íŒŒì†ì œí’ˆ</a>
  <a href="#">ğŸ”§ ê³µêµ¬/ì¥ë¹„</a>
  <a href="#">ğŸ™‹ êµ¬í•´ìš”</a>

  <a href="#" id="navClosing">â° ë§ˆê°ì„ë°•</a>

  <a href="#">ğŸ£ ë ˆì €ìš©í’ˆ</a>
  <a href="#">ğŸ“œ ìš´ì˜ê·œì¹™</a>
  <a href="#" id="navAll">ğŸ”¥ ì§„í–‰ì¤‘ ê²½ë§¤</a>

  <a href="#" id="navSell">ğŸ“ íŒë§¤ë“±ë¡</a>

  <a href="#">ğŸ‘¤ ë§ˆì´í˜ì´ì§€</a>
</nav>

<div class="container">
  <div class="sectionTitle">
    <h2>ğŸ”¥ ì§„í–‰ì¤‘ ê²½ë§¤</h2>
    <span class="pill purple">ì…ì°° 1,000ì› ë‹¨ìœ„</span>
  </div>

  <div class="filterbar">
    <div>
      í˜„ì¬ ë³´ê¸°:
      <span class="badge" id="filterLabel">ì „ì²´</span>
      <span class="small" id="filterDesc">â€” ëª¨ë“  ì§„í–‰ì¤‘ ê²½ë§¤ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.</span>
    </div>
    <div class="linkbtn" id="clearFilter" style="display:none;">í•„í„° í•´ì œ</div>
  </div>

  <p class="hint">
    â€» ì…ì°°ì€ <b>1,000ì› ë‹¨ìœ„</b>ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
    â€» ì…ì°° ì‹œ <b>ë³´ì¦ê¸ˆ 10,000ì›</b> ì•ˆë‚´ì— ë™ì˜(ì²´í¬)í•´ì•¼ ì œì¶œë©ë‹ˆë‹¤.<br>
    â€» ë§ˆê°ëœ ìƒí’ˆì€ ì•„ë˜ <b>â€œë§ˆê°ëœ ê²½ë§¤â€</b>ë¡œ ìë™ ì´ë™í•©ë‹ˆë‹¤.
  </p>

  <div class="cards" id="activeCards"></div>

  <div class="hr"></div>

  <div class="sectionTitle">
    <h3>âœ… ë§ˆê°ëœ ê²½ë§¤</h3>
    <span class="pill gray" id="closedCountPill">0ê±´</span>
  </div>
  <div class="cards" id="closedCards"></div>
</div>

<!-- âœ… ì…ì°° ëª¨ë‹¬ -->
<div class="modal-bg" id="bidModalBg" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title">ì…ì°°í•˜ê¸°</div>
      <button class="modal-close" id="bidModalClose" aria-label="ë‹«ê¸°">Ã—</button>
    </div>
    <div class="modal-body">
      <div class="modal-row"><b>ìƒí’ˆ:</b> <span id="mItem">-</span></div>
      <div class="modal-row"><b>í˜„ì¬ê°€:</b> <span id="mPrice">-</span></div>
      <div class="modal-row"><b>ì…ì°°ê±´ìˆ˜:</b> <span id="mBids">-</span></div>
      <div class="modal-row"><b>ë‚¨ì€ì‹œê°„:</b> <span id="mRemain">-</span></div>

      <label>ì…ì°°ê°€(ì›) â€” <span class="small">1,000ì› ë‹¨ìœ„</span></label>
      <input class="modal-input" id="bidAmount" type="number" min="0" step="1000" placeholder="ì˜ˆ) 15000">

      <div class="checkRow">
        <input type="checkbox" id="depositAgree">
        <div>
          <b>ì…ì°° ë³´ì¦ê¸ˆ 10,000ì›</b> ì•ˆë‚´ë¥¼ í™•ì¸í–ˆìŠµë‹ˆë‹¤.<br>
          (ë°ëª¨ ë‹¨ê³„ë¼ ì‹¤ì œ ê²°ì œëŠ” ì—†ì§€ë§Œ, ê·œì¹™ ì ìš©ì„ ìœ„í•´ ì²´í¬ê°€ í•„ìš”í•©ë‹ˆë‹¤.)
        </div>
      </div>

      <div class="notice">
        âœ… ê·œì¹™: ì…ì°°ê°€ëŠ” <b>í˜„ì¬ê°€ë³´ë‹¤ ì»¤ì•¼</b> í•˜ë©°, <b>1,000ì› ë‹¨ìœ„</b>ë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤.<br>
        âœ… í˜„ì¬ëŠ” ì„œë²„ ì—†ì´ ì´ PC ë¸Œë¼ìš°ì €ì— ì €ì¥ë©ë‹ˆë‹¤(LocalStorage).
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-gray" id="bidCancel">ì·¨ì†Œ</button>
      <button id="bidSubmit">ì…ì°° ì œì¶œ</button>
    </div>
  </div>
</div>

<!-- âœ… ê´€ë¦¬ì ìƒí’ˆ ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
<div class="modal-bg" id="adminModalBg" aria-hidden="true">
  <div class="modal" role="dialog" aria-modal="true">
    <div class="modal-header">
      <div class="modal-title" id="adminTitle">íŒë§¤ë“±ë¡ (ê´€ë¦¬ì)</div>
      <button class="modal-close" id="adminModalClose" aria-label="ë‹«ê¸°">Ã—</button>
    </div>
    <div class="modal-body">
      <label>ìƒí’ˆëª…</label>
      <input class="modal-input" id="aTitle" placeholder="ì˜ˆ) ì „ë™ë“œë¦´ ì„¸íŠ¸">

      <div class="grid2">
        <div>
          <label>ì‹œì‘ê°€(ì›)</label>
          <input class="modal-input" id="aStartPrice" type="number" min="0" step="1000" placeholder="ì˜ˆ) 10000">
        </div>
        <div>
          <label>ë§ˆê°ì‹œê°„</label>
          <input class="modal-input" id="aEnd" type="datetime-local">
        </div>
      </div>

      <label>ì´ë¯¸ì§€ í…ìŠ¤íŠ¸(ì—†ì–´ë„ ë¨)</label>
      <input class="modal-input" id="aImageText" placeholder="ì˜ˆ) ì „ë™ë“œë¦´ / TV / ìº í•‘í…Œì´ë¸”">

      <div class="notice">
        âœ… ë“±ë¡/ìˆ˜ì •í•˜ë©´ ì¹´ë“œì— ì¦‰ì‹œ ë°˜ì˜ë©ë‹ˆë‹¤.<br>
        âœ… ì´ë¯¸ì§€ëŠ” ì—†ìœ¼ë©´ ìë™ìœ¼ë¡œ í…ìŠ¤íŠ¸ ì´ë¯¸ì§€ë¡œ í‘œì‹œë©ë‹ˆë‹¤.
      </div>
    </div>
    <div class="modal-actions">
      <button class="btn-gray" id="adminCancel">ì·¨ì†Œ</button>
      <button id="adminSubmit">ì €ì¥</button>
    </div>
  </div>
</div>

<script>
/* =========================
   ì €ì¥ í‚¤
========================= */
const LS_KEY = "mwodeun_products_v2";

/* =========================
   ìƒíƒœ
========================= */
let currentFilter = "all"; // all | closing
let products = [];         // {id,title,currentPrice,bids,endMs,imageUrl}
let activeBidProductId = null;
let remainTimer = null;

// ê´€ë¦¬ì ëª¨ë‹¬ ëª¨ë“œ: add | edit
let adminMode = "add";
let adminEditingId = null;

/* =========================
   ìœ í‹¸
========================= */
function money(n){
  const x = Number(n || 0);
  return x.toLocaleString("ko-KR") + "ì›";
}
function nowMs(){ return Date.now(); }

function formatRemain(diffMs){
  if (diffMs <= 0) return {text:"ë‚¨ì€ì‹œê°„: ë§ˆê°", closed:true, totalSec:0};
  const totalSec = Math.floor(diffMs/1000);
  const days = Math.floor(totalSec/(60*60*24));
  const hours = Math.floor((totalSec%(60*60*24))/(60*60));
  const mins = Math.floor((totalSec%(60*60))/60);
  const secs = totalSec%60;
  const dText = days>0 ? `${days}ì¼ ` : "";
  return {text:`ë‚¨ì€ì‹œê°„: ${dText}${hours}ì‹œê°„ ${mins}ë¶„ ${secs}ì´ˆ`, closed:false, totalSec};
}

function makePlaceholderImage(text){
  const t = encodeURIComponent((text || "MWODEUN").slice(0,20));
  return `https://via.placeholder.com/300x180/6a0dad/ffffff?text=${t}`;
}

function saveProducts(){
  localStorage.setItem(LS_KEY, JSON.stringify(products));
}

function loadProducts(){
  const raw = localStorage.getItem(LS_KEY);
  if (!raw){
    // ê¸°ë³¸ ìƒ˜í”Œ 3ê°œ(í…ŒìŠ¤íŠ¸ìš©)
    const base = nowMs();
    products = [
      {id:crypto.randomUUID(), title:"ì „ë™ë“œë¦´ ì„¸íŠ¸", currentPrice:10000, bids:3, endMs: base + 70*60*1000, imageUrl: makePlaceholderImage("ì „ë™ë“œë¦´")},
      {id:crypto.randomUUID(), title:"LG 55ì¸ì¹˜ TV (ê³ ì¥)", currentPrice:10000, bids:0, endMs: base + 140*60*1000, imageUrl: makePlaceholderImage("55ì¸ì¹˜ TV")},
      {id:crypto.randomUUID(), title:"ìº í•‘ í…Œì´ë¸”", currentPrice:5000, bids:0, endMs: base + 220*60*1000, imageUrl: makePlaceholderImage("ìº í•‘í…Œì´ë¸”")}
    ];
    saveProducts();
    return;
  }
  try{ products = JSON.parse(raw) || []; }
  catch(e){ products = []; }
}

/* datetime-local ê°’ ë§Œë“¤ê¸° (endMs -> "YYYY-MM-DDTHH:MM") */
function msToLocalInputValue(ms){
  const d = new Date(ms);
  const pad = (n)=> String(n).padStart(2,"0");
  const yyyy = d.getFullYear();
  const mm = pad(d.getMonth()+1);
  const dd = pad(d.getDate());
  const hh = pad(d.getHours());
  const mi = pad(d.getMinutes());
  return `${yyyy}-${mm}-${dd}T${hh}:${mi}`;
}

/* =========================
   ë Œë”
========================= */
function renderAll(){
  const activeWrap = document.getElementById("activeCards");
  const closedWrap = document.getElementById("closedCards");
  activeWrap.innerHTML = "";
  closedWrap.innerHTML = "";

  const now = nowMs();

  // ìµœì‹  ë“±ë¡ì´ ìœ„ë¡œ ì˜¤ê²Œ ìœ ì§€(ë°°ì—´ ì•ì´ ìµœì‹ )
  const active = [];
  const closed = [];

  products.forEach(p => {
    if (p.endMs <= now) closed.push(p);
    else active.push(p);
  });

  document.getElementById("closedCountPill").textContent = `${closed.length}ê±´`;

  // ì§„í–‰ì¤‘ ì¹´ë“œ
  active.forEach(p => activeWrap.appendChild(makeCard(p, false)));
  // ë§ˆê° ì¹´ë“œ
  closed.forEach(p => closedWrap.appendChild(makeCard(p, true)));

  updateCountdownsAndFilter();
}

function makeCard(p, isClosed){
  const card = document.createElement("div");
  card.className = "card" + (isClosed ? " closed" : "");
  card.setAttribute("data-id", p.id);

  card.innerHTML = `
    ${isClosed ? `<div class="closedBadge">ë§ˆê°</div>` : ``}
    <div class="cardTopBar">
      <span class="adminTag">ê´€ë¦¬ì</span>
      <div class="adminTools">
        <button class="btn-small btn-gray editBtn">ìˆ˜ì •</button>
        <button class="btn-small btn-danger delBtn">ì‚­ì œ</button>
      </div>
    </div>

    <img src="${p.imageUrl || makePlaceholderImage(p.title)}" alt="${p.title}">
    <h3>${p.title}</h3>

    <div class="meta">
      <div class="price">í˜„ì¬ê°€: <span class="priceVal">${money(p.currentPrice)}</span></div>
    </div>
    <div class="meta" style="margin-top:-4px;">
      <div class="bids">ì…ì°° <span class="bidsVal">${p.bids}</span>ê±´</div>
      <span class="pill ${isClosed ? "gray" : "purple"}">${isClosed ? "ë§ˆê°" : "ì§„í–‰ì¤‘"}</span>
    </div>

    <div class="remain">ë‚¨ì€ì‹œê°„: ê³„ì‚°ì¤‘...</div>
    <button class="bidBtn" ${isClosed ? "disabled style='opacity:0.55;cursor:not-allowed;'" : ""}>ì…ì°°í•˜ê¸°</button>
  `;

  // ê´€ë¦¬ì ë²„íŠ¼
  card.querySelector(".editBtn").addEventListener("click", () => openAdminModal("edit", p.id));
  card.querySelector(".delBtn").addEventListener("click", () => deleteProduct(p.id));

  // ì…ì°° ë²„íŠ¼
  const bidBtn = card.querySelector(".bidBtn");
  bidBtn.addEventListener("click", () => {
    if (!isClosed) openBidModal(p.id);
  });

  return card;
}

/* =========================
   í•„í„°
========================= */
function setFilter(mode){
  currentFilter = mode;

  const label = document.getElementById("filterLabel");
  const desc  = document.getElementById("filterDesc");
  const clear = document.getElementById("clearFilter");

  if (mode === "closing"){
    label.textContent = "ë§ˆê°ì„ë°•(1ì‹œê°„ ì´í•˜)";
    desc.textContent = "â€” ë‚¨ì€ ì‹œê°„ì´ 1ì‹œê°„ ì´í•˜ì¸ ì§„í–‰ì¤‘ ê²½ë§¤ë§Œ í‘œì‹œí•©ë‹ˆë‹¤.";
    clear.style.display = "block";
  }else{
    label.textContent = "ì „ì²´";
    desc.textContent = "â€” ëª¨ë“  ì§„í–‰ì¤‘ ê²½ë§¤ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤.";
    clear.style.display = "none";
  }
  updateCountdownsAndFilter();
}

document.getElementById("navClosing").addEventListener("click",(e)=>{e.preventDefault(); setFilter("closing");});
document.getElementById("navAll").addEventListener("click",(e)=>{e.preventDefault(); setFilter("all");});
document.getElementById("clearFilter").addEventListener("click", ()=>setFilter("all"));

/* =========================
   ì¹´ìš´íŠ¸ë‹¤ìš´ + í•„í„° ì ìš©
   - ì§„í–‰ì¤‘ ë¦¬ìŠ¤íŠ¸ì—ë§Œ í•„í„° ì ìš©
   - ë§ˆê° ë¦¬ìŠ¤íŠ¸ëŠ” ê·¸ëŒ€ë¡œ í‘œì‹œ
   - ì§„í–‰ì¤‘ì—ì„œ ë§ˆê°ìœ¼ë¡œ ë„˜ì–´ê°€ëŠ” ìˆœê°„ ìë™ ì¬ë Œë”
========================= */
function updateCountdownsAndFilter(){
  const now = nowMs();
  let crossed = false;

  // ì§„í–‰ì¤‘/ë§ˆê° ìƒíƒœê°€ ë°”ë€Œë©´ rerender
  products.forEach(p => {
    if (p.endMs <= now && !p._closedFlag) { p._closedFlag = true; crossed = true; }
    if (p.endMs >  now && p._closedFlag) { p._closedFlag = false; crossed = true; }
  });

  if (crossed){
    renderAll();
    return;
  }

  // ì¹´ë“œë³„ ì—…ë°ì´íŠ¸
  document.querySelectorAll(".card").forEach(card => {
    const id = card.getAttribute("data-id");
    const p = products.find(x=>x.id===id);
    if (!p) return;

    const diff = p.endMs - now;
    const info = formatRemain(diff);

    const remainEl = card.querySelector(".remain");
    if (info.closed){
      remainEl.textContent = "ë‚¨ì€ì‹œê°„: ë§ˆê°";
      remainEl.style.color = "gray";
      return;
    }else{
      remainEl.textContent = info.text;
      remainEl.style.color = "#d40000";
    }

    // âœ… í•„í„°ëŠ” ì§„í–‰ì¤‘ ì˜ì—­(ë§ˆê° ì•„ë‹Œ ì¹´ë“œ)ì—ì„œë§Œ ì ìš©
    const isInClosed = card.classList.contains("closed");
    if (!isInClosed){
      if (currentFilter === "closing"){
        card.style.display = (info.totalSec <= 3600) ? "" : "none";
      }else{
        card.style.display = "";
      }
    }
  });

  // í•„í„° ë•Œë¬¸ì— í˜„ì¬ ì…ì°° ëª¨ë‹¬ì´ ì—´ë¦° ìƒí’ˆì´ ìˆ¨ê²¨ì§€ë©´ ëª¨ë‹¬ ë‹«ê¸°
  if (activeBidProductId){
    const card = document.querySelector(`.card[data-id="${activeBidProductId}"]`);
    if (card && card.style.display === "none") closeBidModal();
  }
}

/* =========================
   ì…ì°° ëª¨ë‹¬ (1000ì› ë‹¨ìœ„ + ë³´ì¦ê¸ˆ ì²´í¬)
========================= */
const bidModalBg = document.getElementById("bidModalBg");
const bidModalClose = document.getElementById("bidModalClose");
const bidCancel = document.getElementById("bidCancel");
const bidSubmit = document.getElementById("bidSubmit");

const mItem = document.getElementById("mItem");
const mPrice = document.getElementById("mPrice");
const mBids = document.getElementById("mBids");
const mRemain = document.getElementById("mRemain");
const bidAmount = document.getElementById("bidAmount");
const depositAgree = document.getElementById("depositAgree");

function openBidModal(productId){
  activeBidProductId = productId;
  const p = products.find(x=>x.id===productId);
  if (!p) return;

  // ë§ˆê°ì´ë©´ ë°©ì§€
  if (p.endMs <= nowMs()){
    alert("ì´ë¯¸ ë§ˆê°ëœ ìƒí’ˆì…ë‹ˆë‹¤.");
    return;
  }

  mItem.textContent = p.title;
  mPrice.textContent = money(p.currentPrice);
  mBids.textContent = `${p.bids}ê±´`;

  depositAgree.checked = false;
  bidAmount.value = "";

  // ë‚¨ì€ì‹œê°„ ëª¨ë‹¬ ì•ˆì—ì„œ ê°±ì‹ 
  if (remainTimer) clearInterval(remainTimer);
  const tick = () => {
    const diff = p.endMs - nowMs();
    const info = formatRemain(diff);
    mRemain.textContent = info.closed ? "ë§ˆê°" : info.text.replace("ë‚¨ì€ì‹œê°„: ","");
    if (info.closed){
      closeBidModal();
      renderAll();
    }
  };
  tick();
  remainTimer = setInterval(tick, 1000);

  bidModalBg.style.display = "flex";
  bidModalBg.setAttribute("aria-hidden","false");
  bidAmount.focus();
}

function closeBidModal(){
  bidModalBg.style.display = "none";
  bidModalBg.setAttribute("aria-hidden","true");
  activeBidProductId = null;
  if (remainTimer) clearInterval(remainTimer);
  remainTimer = null;
}

bidModalClose.addEventListener("click", closeBidModal);
bidCancel.addEventListener("click", closeBidModal);
bidModalBg.addEventListener("click",(e)=>{ if(e.target===bidModalBg) closeBidModal(); });
document.addEventListener("keydown",(e)=>{ if(e.key==="Escape" && bidModalBg.style.display==="flex") closeBidModal(); });

bidSubmit.addEventListener("click", ()=>{
  if (!activeBidProductId) return;
  const p = products.find(x=>x.id===activeBidProductId);
  if (!p) return;

  // ë§ˆê° ì²´í¬
  if (p.endMs <= nowMs()){
    alert("ì´ë¯¸ ë§ˆê°ëœ ìƒí’ˆì…ë‹ˆë‹¤.");
    closeBidModal();
    renderAll();
    return;
  }

  const v = Number((bidAmount.value || "").trim());
  if (!v){
    alert("ì…ì°°ê°€ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.");
    bidAmount.focus();
    return;
  }

  // âœ… 1000ì› ë‹¨ìœ„ ì²´í¬
  if (v % 1000 !== 0){
    alert("ì…ì°°ê°€ëŠ” 1,000ì› ë‹¨ìœ„ë¡œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤. (ì˜ˆ: 15000)");
    bidAmount.focus();
    return;
  }

  // âœ… í˜„ì¬ê°€ë³´ë‹¤ ì»¤ì•¼ í•¨
  if (v <= p.currentPrice){
    alert(`ì…ì°°ê°€ëŠ” í˜„ì¬ê°€ë³´ë‹¤ ì»¤ì•¼ í•©ë‹ˆë‹¤.\ní˜„ì¬ê°€: ${money(p.currentPrice)}`);
    bidAmount.focus();
    return;
  }

  // âœ… ë³´ì¦ê¸ˆ ì•ˆë‚´ ì²´í¬ í•„ìˆ˜
  if (!depositAgree.checked){
    alert("ì…ì°° ë³´ì¦ê¸ˆ 10,000ì› ì•ˆë‚´ë¥¼ í™•ì¸(ì²´í¬)í•´ì•¼ ì…ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.");
    return;
  }

  // âœ… ë°˜ì˜
  p.currentPrice = v;
  p.bids = (p.bids || 0) + 1;
  saveProducts();

  // ì¹´ë“œ ì¦‰ì‹œ ì—…ë°ì´íŠ¸
  const card = document.querySelector(`.card[data-id="${p.id}"]`);
  if (card){
    card.querySelector(".priceVal").textContent = money(p.currentPrice);
    card.querySelector(".bidsVal").textContent = p.bids;
  }

  alert(`ì…ì°° ì™„ë£Œ(ë°ëª¨): ${money(v)}\n(í˜„ì¬ê°€/ì…ì°°ê±´ìˆ˜ ë°˜ì˜ë¨)`);
  closeBidModal();
});

/* =========================
   ê´€ë¦¬ì ëª¨ë‹¬ (ì¶”ê°€/ìˆ˜ì •) + ì‚­ì œ
========================= */
const adminModalBg = document.getElementById("adminModalBg");
const adminModalClose = document.getElementById("adminModalClose");
const adminCancel = document.getElementById("adminCancel");
const adminSubmit = document.getElementById("adminSubmit");

const adminTitleEl = document.getElementById("adminTitle");
const aTitle = document.getElementById("aTitle");
const aStartPrice = document.getElementById("aStartPrice");
const aEnd = document.getElementById("aEnd");
const aImageText = document.getElementById("aImageText");

function openAdminModal(mode="add", id=null){
  adminMode = mode;
  adminEditingId = id;

  if (mode === "add"){
    adminTitleEl.textContent = "íŒë§¤ë“±ë¡ (ê´€ë¦¬ì)";
    aTitle.value = "";
    aStartPrice.value = "";
    aImageText.value = "";
    // ê¸°ë³¸ ë§ˆê°ì‹œê°„: ì§€ê¸ˆ + 2ì‹œê°„
    aEnd.value = msToLocalInputValue(nowMs() + 2*60*60*1000);
  }else{
    const p = products.find(x=>x.id===id);
    if (!p) return;
    adminTitleEl.textContent = "ìƒí’ˆ ìˆ˜ì • (ê´€ë¦¬ì)";
    aTitle.value = p.title;
    aStartPrice.value = p.currentPrice;
    aEnd.value = msToLocalInputValue(p.endMs);
    // ì´ë¯¸ì§€í…ìŠ¤íŠ¸ëŠ” ì €ì¥ ì•ˆ ë˜ì–´ ìˆì–´ì„œ, ì—¬ê¸°ì„œëŠ” ë¹„ì›Œë‘ê³  ìƒˆë¡œ ì…ë ¥ ë°›ìŒ
    aImageText.value = "";
  }

  adminModalBg.style.display = "flex";
  adminModalBg.setAttribute("aria-hidden","false");
  aTitle.focus();
}

function closeAdminModal(){
  adminModalBg.style.display = "none";
  adminModalBg.setAttribute("aria-hidden","true");
}

document.getElementById("navSell").addEventListener("click",(e)=>{e.preventDefault(); openAdminModal("add");});
adminModalClose.addEventListener("click", closeAdminModal);
adminCancel.addEventListener("click", closeAdminModal);
adminModalBg.addEventListener("click",(e)=>{ if(e.target===adminModalBg) closeAdminModal(); });

adminSubmit.addEventListener("click", ()=>{
  const title = (aTitle.value || "").trim();
  const startPrice = Number((aStartPrice.value || "").trim());
  const endVal = (aEnd.value || "").trim();
  const imgText = (aImageText.value || "").trim();

  if (!title){ alert("ìƒí’ˆëª…ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); aTitle.focus(); return; }
  if (!startPrice && startPrice !== 0){ alert("ì‹œì‘ê°€(ì›)ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”."); aStartPrice.focus(); return; }
  if (startPrice % 1000 !== 0){ alert("ì‹œì‘ê°€ëŠ” 1,000ì› ë‹¨ìœ„ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”."); aStartPrice.focus(); return; }
  if (!endVal){ alert("ë§ˆê°ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”."); aEnd.focus(); return; }

  const endMs = new Date(endVal).getTime();
  if (isNaN(endMs)){ alert("ë§ˆê°ì‹œê°„ ê°’ì´ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤."); return; }
  if (endMs <= nowMs() + 30*1000){
    alert("ë§ˆê°ì‹œê°„ì€ â€˜ì§€ê¸ˆë³´ë‹¤ ë¯¸ë˜â€™ë¡œ ì„¤ì •í•´ì£¼ì„¸ìš”. (ìµœì†Œ 30ì´ˆ ì´í›„)");
    aEnd.focus(); return;
  }

  const imageUrl = makePlaceholderImage(imgText || title);

  if (adminMode === "add"){
    const newItem = {
      id: crypto.randomUUID(),
      title,
      currentPrice: startPrice,
      bids: 0,
      endMs,
      imageUrl
    };
    products.unshift(newItem);
  }else{
    const p = products.find(x=>x.id===adminEditingId);
    if (!p) return;
    p.title = title;
    p.currentPrice = startPrice;
    // ìˆ˜ì •í•˜ë©´ ì…ì°° ê±´ìˆ˜ëŠ” ìœ ì§€ (ì›ì¥í˜¸ë‹˜ ì›í•˜ì‹œë©´ 0ìœ¼ë¡œ ì´ˆê¸°í™”ë„ ê°€ëŠ¥)
    p.endMs = endMs;
    // ì´ë¯¸ì§€í…ìŠ¤íŠ¸ ì…ë ¥í–ˆìœ¼ë©´ ì´ë¯¸ì§€ ê°±ì‹ , ì•„ë‹ˆë©´ ê¸°ì¡´ ìœ ì§€
    if (imgText) p.imageUrl = imageUrl;
  }

  saveProducts();
  closeAdminModal();
  renderAll();
  alert(adminMode === "add" ? "ìƒí’ˆì´ ë“±ë¡ë˜ì—ˆìŠµë‹ˆë‹¤!" : "ìƒí’ˆì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤!");
});

function deleteProduct(id){
  const p = products.find(x=>x.id===id);
  if (!p) return;
  const ok = confirm(`ì •ë§ ì‚­ì œí• ê¹Œìš”?\n\nìƒí’ˆ: ${p.title}`);
  if (!ok) return;

  products = products.filter(x=>x.id!==id);
  saveProducts();
  renderAll();
}

/* =========================
   ì´ˆê¸° ì‹¤í–‰
========================= */
loadProducts();
renderAll();
setFilter("all");
setInterval(updateCountdownsAndFilter, 1000);
</script>

</body>
</html>
