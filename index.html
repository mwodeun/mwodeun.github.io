<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MWODEUN ëª¨ë“ ê²½ë§¤</title>
  <style>
    :root{
      --purple:#6a0dad;
      --purple2:#7c1dd1;
      --bg:#f5f5f5;
      --card:#ffffff;
      --muted:#666;
      --border:#e6e6e6;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background:var(--bg);
      color:#111;
    }

    header{
      position:sticky;
      top:0;
      z-index:50;
      background:#fff;
      border-bottom:1px solid var(--border);
    }

    .bannerArea{
      background:#fff;
      border-bottom:1px solid rgba(0,0,0,.05);
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:12px 16px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:260px;
    }
    .brand img{
      height:78px;
      width:auto;
      display:block;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,.10));
    }
    .brand .title{
      font-weight:900;
      font-size:18px;
      line-height:1.1;
    }
    .brand .sub{
      font-size:12px;
      color:#1f2937;
      opacity:.85;
      margin-top:4px;
      font-weight:700;
    }

    .bannerMarquee{
      margin-top:8px;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
      overflow:hidden;
    }
    .marqueeTrack{
      display:flex;
      width:100%;
      justify-content:center;
      overflow:hidden;
    }
    .marqueeText{
      display:inline-block;
      white-space:nowrap;
      font-weight:900;
      color:#111;
      opacity:.85;
      animation: marqueeLR 14s linear infinite;
    }
    @keyframes marqueeLR{
      0%{ transform: translateX(-55%); }
      100%{ transform: translateX(55%); }
    }

    .controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      min-width:320px;
      flex:1;
    }

    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:12px;
    }
    .chip label{
      font-size:12px;
      color:#111;
      opacity:.7;
      white-space:nowrap;
      font-weight:800;
    }
    input[type="text"], input[type="number"], input[type="datetime-local"], select{
      padding:8px 10px;
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      outline:none;
      background:#fff;
    }
    input[type="text"]{min-width:170px}
    select{min-width:120px}

    .btn{
      cursor:pointer;
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:900;
    }
    .btn.primary{background:var(--purple); color:#fff;}
    .btn.gray{background:#eee; color:#111;}
    .btn.danger{background:#d93025; color:#fff;}
    .btn.small{padding:7px 10px; border-radius:10px; font-size:12px}
    .btn.soft{background:#f3f0ff; color:#2b0a4a; border:1px solid rgba(106,13,173,.18);}
    .btn.soft:disabled{opacity:.5; cursor:not-allowed;}
    .btn.primary:disabled{opacity:.55; cursor:not-allowed;}

    .primaryNav{
      background: linear-gradient(90deg, var(--purple) 0%, var(--purple2) 100%);
      border-top:1px solid rgba(255,255,255,.18);
      border-bottom:1px solid rgba(0,0,0,.18);
    }
    .primaryNav .wrap{
      padding:8px 16px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;
    }
    .navLink{
      color:#fff;
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(255,255,255,.08);
    }
    .navLink:hover{ background:rgba(255,255,255,.14); }

    .categoryRow{
      background:#fff;
      border-bottom:1px solid var(--border);
    }
    .categoryRow .wrap{
      padding:10px 16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .catBtn{
      cursor:pointer;
      border:1px solid var(--border);
      background:transparent;
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
      color:#111;
    }
    .catBtn.active{
      border-color:var(--purple);
      color:var(--purple);
      box-shadow:0 0 0 3px rgba(106,13,173,.08);
    }

    .adminPanel{
      display:none;
      margin-top:12px;
      padding:14px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:16px;
      box-shadow:0 10px 22px rgba(0,0,0,.08);
    }
    .adminGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .adminGrid .full{grid-column:1 / -1}

    main .wrap{padding:18px 16px 70px}
    h2{
      margin:24px 0 12px;
      font-size:20px;
    }
    .sectionHint{
      color:var(--muted);
      font-size:13px;
      margin-top:-6px;
      margin-bottom:14px;
      line-height:1.45;
    }

    .grid{
      display:flex;
      flex-wrap:wrap;
      gap:16px;
      justify-content:center;
    }
    .card{
      width:min(330px, 100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 8px 18px rgba(0,0,0,0.06);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .card.closed{
      background:#e9e9e9;
      filter:grayscale(0.15);
    }
    .card .body{ padding:14px 14px 12px; }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(106,13,173,.1);
      color:var(--purple);
      border:1px solid rgba(106,13,173,.18);
      white-space:nowrap;
    }
    .badge.closed{
      background:rgba(0,0,0,.08);
      color:#222;
      border-color:rgba(0,0,0,.1);
    }
    .badge.bad{background:rgba(217,48,37,.10); color:#b42318; border-color:rgba(217,48,37,.25);}
    .badge.good{background:rgba(0,128,0,.10); color:#0f6a1a; border-color:rgba(0,128,0,.22);}
    .name{
      font-size:18px;
      font-weight:900;
      margin:8px 0 8px;
      word-break:keep-all;
    }
    .meta{
      font-size:13px;
      color:var(--muted);
      line-height:1.45;
    }
    .price{
      margin-top:10px;
      font-size:16px;
      font-weight:900;
    }
    .price span{color:var(--purple)}
    .divider{
      height:1px;
      background:var(--border);
      margin:12px 0;
    }
    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .bidBox{
      margin-top:10px;
      padding:10px;
      border:1px dashed rgba(106,13,173,.35);
      border-radius:12px;
      background:rgba(106,13,173,.04);
    }
    .bidHelp{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      line-height:1.35;
    }
    .smallText{font-size:12px; color:var(--muted)}
    .countdown{font-weight:900}
    .lastBidder{font-weight:900; color:#111;}

    .summaryBox{
      margin-top:22px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 8px 18px rgba(0,0,0,0.05);
      overflow:hidden;
    }
    .summaryHead{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--border);
    }
    .summaryHead .ttl{
      font-size:18px;
      font-weight:900;
    }
    .summaryHead .hint{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }
    .summaryGrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
    }
    .sumCol{
      padding:12px 12px 14px;
      min-height:140px;
      border-left:1px solid var(--border);
    }
    .sumCol:first-child{border-left:none;}
    .sumTitle{
      font-weight:900;
      margin-bottom:10px;
      color:#111;
    }
    .sumItem{
      padding:10px 8px;
      border:1px solid rgba(0,0,0,.06);
      border-radius:12px;
      background:#fafafa;
      margin-bottom:10px;
    }
    .sumLine{
      font-size:12px;
      color:#111;
      line-height:1.45;
    }
    .sumLine b{font-weight:900;}
    .sumEmpty{
      font-size:12px;
      color:var(--muted);
      padding:6px 2px;
      font-weight:700;
    }

    /* âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ(ë ˆì´ì•„ì›ƒ ì˜í–¥ ì—†ìŒ: fixed overlay) */
    .dashBtn{
      position:fixed;
      right:18px;
      bottom:18px;
      z-index:999;
      background:var(--purple);
      color:#fff;
      border:none;
      border-radius:14px;
      padding:12px 14px;
      font-weight:900;
      cursor:pointer;
      box-shadow:0 10px 20px rgba(0,0,0,.18);
    }
    .dashOverlay{
      position:fixed;
      inset:0;
      background:rgba(0,0,0,.35);
      z-index:1000;
      display:none;
      align-items:flex-start;
      justify-content:center;
      padding:22px 14px;
      overflow:auto;
    }
    .dashPanel{
      width:min(1100px, 100%);
      background:#fff;
      border-radius:18px;
      border:1px solid rgba(0,0,0,.12);
      box-shadow:0 20px 60px rgba(0,0,0,.25);
      overflow:hidden;
    }
    .dashTop{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      border-bottom:1px solid var(--border);
      background:#fff;
    }
    .dashTop .ttl{
      font-size:18px;
      font-weight:900;
    }
    .dashTabs{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      padding:10px 12px;
      border-bottom:1px solid var(--border);
      background:#fafafa;
    }
    .dashTab{
      cursor:pointer;
      border:1px solid var(--border);
      background:#fff;
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
    }
    .dashTab.active{
      border-color:var(--purple);
      color:var(--purple);
      box-shadow:0 0 0 3px rgba(106,13,173,.08);
    }
    .dashBody{
      padding:14px 16px 18px;
    }
    .dashRow{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      padding:10px 8px;
      border-bottom:1px solid rgba(0,0,0,.06);
      flex-wrap:wrap;
    }
    .dashRow b{font-weight:900}
    .dashKpi{
      display:grid;
      grid-template-columns: repeat(5, 1fr);
      gap:10px;
      margin-top:10px;
    }
    .kpiCard{
      border:1px solid rgba(0,0,0,.08);
      border-radius:14px;
      padding:12px 12px;
      background:#fff;
      box-shadow:0 8px 16px rgba(0,0,0,.05);
    }
    .kpiCard .k{font-size:12px; color:var(--muted); font-weight:900;}
    .kpiCard .v{font-size:16px; font-weight:900; margin-top:6px;}
    @media (max-width:980px){
      .summaryGrid{ grid-template-columns: 1fr; }
      .sumCol{ border-left:none; border-top:1px solid var(--border); }
      .sumCol:first-child{ border-top:none; }
      .dashKpi{ grid-template-columns: 1fr; }
    }
    @media (max-width:720px){
      .adminGrid{grid-template-columns:1fr}
      input[type="text"]{min-width:140px}
      .brand{min-width:auto}
      .brand img{height:68px;}
    }
  </style>
</head>

<body>
  <header>
    <div class="bannerArea">
      <div class="wrap">
        <div class="topbar">
          <div class="brand">
            <img src="logo.png" alt="MWODEUN ëª¨ë“ ê²½ë§¤" onerror="this.style.display='none'">
            <div>
              <div class="title">MWODEUN ëª¨ë“ ê²½ë§¤</div>
              <div class="sub">ì¤‘ê³  ë¬¼í’ˆë§Œ ë“±ë¡ Â· ì‹œì‘ê°€+ë§ˆê°ì‹œê°„+ìë™ì—°ì¥</div>
            </div>
          </div>

          <div class="controls">
            <div class="chip">
              <label>ë‹‰ë„¤ì„</label>
              <input id="nickname" type="text" placeholder="ì…ì°° ë‹‰ë„¤ì„" />
            </div>

            <div class="chip">
              <label>ìë™ ì¦ê°€</label>
              <select id="incSelect">
                <option value="1000">+1,000ì›</option>
                <option value="5000">+5,000ì›</option>
                <option value="10000">+10,000ì›</option>
                <option value="50000">+50,000ì›</option>
              </select>
            </div>

            <button class="btn primary" onclick="toggleAdmin()">ê´€ë¦¬ì ìƒí’ˆì¶”ê°€</button>
            <button class="btn gray" onclick="resetToSample()" title="ìƒ˜í”Œë°ì´í„°ë¡œ ì´ˆê¸°í™”">ìƒ˜í”Œì´ˆê¸°í™”</button>
          </div>
        </div>

        <div class="bannerMarquee">
          <div class="marqueeTrack">
            <div class="marqueeText" id="bannerText">
              MWODEUN ëª¨ë“ ê²½ë§¤ì— ì˜¤ì‹  ê²ƒì„ í™˜ì˜í•©ë‹ˆë‹¤ Â· ë³´ì¦ê¸ˆ 10,000ì› ê³„ì¢Œì…ê¸ˆ í›„ ì…ì°° Â· ë‚™ì°° í›„ 48ì‹œê°„ ë‚´ ê²°ì œì™„ë£Œ Â· ê±°ë˜ì™„ë£Œ(íŒë§¤ì+êµ¬ë§¤ì) í™•ì¸ ì‹œ ë³´ì¦ê¸ˆ í™˜ë¶ˆ Â· ë¯¸ì´í–‰ ì‹œ ë³´ì¦ê¸ˆ(íŒë§¤ì 8,000 / í”Œë«í¼ 2,000) ë¶„ë°°
            </div>
          </div>
        </div>

        <div class="adminPanel" id="adminPanel">
          <div class="adminGrid">
            <div>
              <div class="smallText">ìƒí’ˆëª…</div>
              <input id="a_title" type="text" placeholder="ì˜ˆ) ìº í•‘ í…Œì´ë¸”" />
            </div>
            <div>
              <div class="smallText">ì¹´í…Œê³ ë¦¬</div>
              <select id="a_category">
                <option value="ê°€ì „">ê°€ì „</option>
                <option value="ê³µêµ¬/ì¥ë¹„">ê³µêµ¬/ì¥ë¹„</option>
                <option value="ì „ììŠ¤í¬ë©">ì „ììŠ¤í¬ë©</option>
                <option value="ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ">ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ</option>
                <option value="ê±´ì„¤ ì”ì—¬ìì¬">ê±´ì„¤ ì”ì—¬ìì¬</option>
              </select>
            </div>

            <div>
              <div class="smallText">ì‹œì‘ê°€(ì›)</div>
              <input id="a_startPrice" type="number" min="0" placeholder="ì˜ˆ) 15000" />
            </div>
            <div>
              <div class="smallText">ë§ˆê°ì‹œê°„</div>
              <input id="a_endTime" type="datetime-local" />
            </div>

            <div class="full" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-start; margin-top:6px;">
              <button class="btn primary" onclick="adminSave()">ë“±ë¡/ìˆ˜ì • ì €ì¥</button>
              <button class="btn gray" onclick="adminClear()">ì…ë ¥ì¹¸ ë¹„ìš°ê¸°</button>
              <span class="smallText" id="adminModeText">í˜„ì¬: ìƒˆ ìƒí’ˆ ë“±ë¡ ëª¨ë“œ</span>
            </div>

            <div class="full" style="margin-top:8px;">
              <div class="smallText" style="font-weight:900; margin-bottom:6px;">ë³´ì¦ê¸ˆ ì…ê¸ˆ ê³„ì¢Œ(ì•ˆë‚´/ê¸°ë¡ìš©)</div>
              <div class="smallText" id="depositAccountText"></div>
            </div>
          </div>
        </div>

      </div>
    </div>

    <div class="primaryNav">
      <div class="wrap">
        <a class="navLink" href="#" onclick="return false;">HOME</a>
        <a class="navLink" href="#" onclick="return false;">íšŒì›ê°€ì…</a>
        <a class="navLink" href="#" onclick="return false;">ë¡œê·¸ì¸</a>
        <a class="navLink" href="#" onclick="return false;">ì´ìš©ì•ˆë‚´</a>
        <a class="navLink" href="#" onclick="return false;">ê³ ê°ì„¼í„°</a>
      </div>
    </div>

    <div class="categoryRow">
      <div class="wrap" id="categoryBar"></div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <h2>ì§„í–‰ì¤‘ ê²½ë§¤</h2>
      <div class="sectionHint">
        ë§ˆê°ì‹œê°„ì´ ì§€ë‚˜ë©´ ìë™ìœ¼ë¡œ â€œë§ˆê° ì¹´ë“œâ€ë¡œ ì´ë™í•©ë‹ˆë‹¤. (LocalStorage ì €ì¥ë¨)
        <br>â€» ë°ëª¨ ëª¨ë“œì—ì„œëŠ” ì§„í–‰ì¤‘ ì¹´ë“œê°€ ìµœì†Œ 3ê°œ ìœ ì§€ë˜ë„ë¡ ìë™ ìƒì„±ë©ë‹ˆë‹¤.
      </div>
      <div class="grid" id="openGrid"></div>

      <div id="closedSection" style="display:none;">
        <h2 style="margin-top:42px;">ë§ˆê° ì¹´ë“œ</h2>
        <div class="sectionHint">ë§ˆê°ëœ ìƒí’ˆë§Œ ì´ê³³ì— ëª¨ì…ë‹ˆë‹¤. (ê²°ì œ/ê±°ë˜ì™„ë£Œ/ë¯¸ì´í–‰ ì²˜ë¦¬ í›„ ìë™ìœ¼ë¡œ í™”ë©´ì—ì„œ ìˆ¨ê¹€)</div>
        <div class="grid" id="closedGrid"></div>
      </div>

      <div class="summaryBox" id="summaryBox">
        <div class="summaryHead">
          <div class="ttl">ì§„í–‰ì¤‘ì¸ ê²½ë§¤</div>
          <div class="hint">ì¹´í…Œê³ ë¦¬ë³„ â€œìƒí’ˆëª… / í˜„ì¬ê°€ / ë‚¨ì€ì‹œê°„â€</div>
        </div>
        <div class="summaryGrid" id="summaryGrid"></div>
      </div>

    </div>
  </main>

  <!-- âœ… ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ(ê³ ì • ë²„íŠ¼ + ì˜¤ë²„ë ˆì´) -->
  <button class="dashBtn" onclick="toggleDashboard()">ê´€ë¦¬ì ê´€ë¦¬</button>
  <div class="dashOverlay" id="dashOverlay" onclick="dashBackdropClose(event)">
    <div class="dashPanel">
      <div class="dashTop">
        <div class="ttl">ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ</div>
        <div style="display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <button class="btn gray small" onclick="refreshDashboard()">ìƒˆë¡œê³ ì¹¨</button>
          <button class="btn danger small" onclick="toggleDashboard()">ë‹«ê¸°</button>
        </div>
      </div>

      <div class="dashTabs">
        <button class="dashTab active" id="tab_trade" onclick="setDashTab('trade')">ğŸ“Š ê±°ë˜ ê´€ë¦¬</button>
        <button class="dashTab" id="tab_deposit" onclick="setDashTab('deposit')">ğŸ’° ë³´ì¦ê¸ˆ ì •ì‚°</button>
        <button class="dashTab" id="tab_users" onclick="setDashTab('users')">ğŸš« ì œì¬ ì‚¬ìš©ì</button>
      </div>

      <div class="dashBody">
        <div id="dashTrade"></div>
        <div id="dashDeposit" style="display:none;"></div>
        <div id="dashUsers" style="display:none;"></div>
      </div>
    </div>
  </div>

  <script>
    /* ===== í‘œì‹œ ê°œìˆ˜/ë°ëª¨ ì±„ì›€ ===== */
    const UI_LIMITS = {
      MIN_OPEN_CARDS: 3,
      MAX_OPEN_SHOW: 12,
      MAX_CLOSED_SHOW: 12,
      DEMO_FILL_OPEN: true,
      HIDE_FINISHED_CLOSED: true
    };

    /* ===== ê·œì¹™ ===== */
    const RULES = {
      depositAmount: 10000,
      nonPaymentHours: 48,
      penalty: { seller: 8000, platform: 2000 },
      sanctions: { warnAt: 1, suspendAt: 2, suspendDays: 30, banAt: 3 }
    };

    const DEPOSIT_ACCOUNT = { bank: "ë†í˜‘", number: "000-0000-0000-00", name: "MWODEUN(ì˜ˆì¹˜ê¸ˆ)" };

    /* ===== LocalStorage Keys ===== */
    const LS_KEY_NEW = "mwodeun_products_rules_v3";
    const LS_KEY_PREV = "mwodeun_products_rules_v2";
    const LS_KEY_OLD  = "mwodeun_products_final_v1";
    const LS_FILTER = "mwodeun_filter_final_v1";
    const LS_USERS  = "mwodeun_users_rules_v2";
    const LS_LEDGER = "mwodeun_ledger_rules_v2";

    function nowISO(){ return new Date().toISOString(); }
    function formatMoney(n){ return Number(n||0).toLocaleString("ko-KR"); }
    function toLocalInputValue(date){
      const pad = n => String(n).padStart(2,'0');
      return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }
    function cryptoRandomId(){ return "p_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16); }

    function calcRemain(endIso){
      const end = new Date(endIso).getTime();
      const now = Date.now();
      const diff = end - now;
      if (isNaN(end)) return {closed:false, text:"ì‹œê°„ì •ë³´ ì—†ìŒ"};
      if (diff <= 0) return {closed:true, text:"ë§ˆê°"};
      const sec = Math.floor(diff/1000);
      const h = Math.floor(sec/3600);
      const m = Math.floor((sec%3600)/60);
      const s = sec%60;
      return {closed:false, text:`${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ`};
    }
    function calcRemainFromMs(targetMs){
      const now = Date.now();
      const diff = targetMs - now;
      if (diff <= 0) return {over:true, text:"ê¸°í•œ ë§Œë£Œ"};
      const sec = Math.floor(diff/1000);
      const h = Math.floor(sec/3600);
      const m = Math.floor((sec%3600)/60);
      const s = sec%60;
      return {over:false, text:`${h}ì‹œê°„ ${m}ë¶„ ${s}ì´ˆ`};
    }
    function formatEndTime(iso){
      const d = new Date(iso);
      if (isNaN(d.getTime())) return "ì‹œê°„ì •ë³´ ì—†ìŒ";
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ` +
             `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    }

    /* ===== Users(Sanctions) ===== */
    function loadUsers(){
      try{
        const raw = localStorage.getItem(LS_USERS);
        if(!raw) return {};
        const parsed = JSON.parse(raw);
        if(!parsed || typeof parsed !== "object") return {};
        return parsed;
      }catch(e){ return {}; }
    }
    function saveUsers(users){ localStorage.setItem(LS_USERS, JSON.stringify(users)); }
    function getUser(users, nick){
      if(!users[nick]) users[nick] = { nick, strikes:0, suspendedUntil:0, banned:false, createdAt: nowISO() };
      return users[nick];
    }
    function userStatusText(u){
      if(u.banned) return "ì˜êµ¬ì •ì§€";
      if(u.suspendedUntil && u.suspendedUntil > Date.now()){
        const remain = calcRemainFromMs(u.suspendedUntil);
        return `ì •ì§€ì¤‘(${remain.text})`;
      }
      if(u.strikes >= 1) return `ê²½ê³ /ëˆ„ì  ${u.strikes}`;
      return "ì •ìƒ";
    }
    function canBid(u){
      if(u.banned) return {ok:false, msg:"ì˜êµ¬ì •ì§€ ìƒíƒœë¼ ì…ì°°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};
      if(u.suspendedUntil && u.suspendedUntil > Date.now()) return {ok:false, msg:"ì •ì§€ ê¸°ê°„ ì¤‘ì—ëŠ” ì…ì°°í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤."};
      return {ok:true, msg:"OK"};
    }

    /* ===== Ledger ===== */
    function loadLedger(){
      try{
        const raw = localStorage.getItem(LS_LEDGER);
        if(!raw) return [];
        const parsed = JSON.parse(raw);
        if(!Array.isArray(parsed)) return [];
        return parsed;
      }catch(e){ return []; }
    }
    function saveLedger(arr){ localStorage.setItem(LS_LEDGER, JSON.stringify(arr)); }
    function ledgerAdd(type, payload){
      const ledger = loadLedger();
      ledger.unshift({ id: cryptoRandomId(), type, at: nowISO(), ...payload });
      saveLedger(ledger);
    }

    /* ===== Products Load/Migrate ===== */
    function normalizeProduct(p){
      const n = {...p};
      n.id = n.id || cryptoRandomId();
      n.title = n.title || "-";
      n.category = n.category || "ê°€ì „";
      n.startPrice = Number(n.startPrice || 0);
      n.currentPrice = Number(n.currentPrice || n.startPrice || 0);
      n.endTime = n.endTime || new Date(Date.now()+3600*1000).toISOString();
      n.highestBidder = n.highestBidder || "";
      n.bidCount = Number(n.bidCount || 0);
      n.createdAt = n.createdAt || nowISO();
      n.closed = !!n.closed;

      n.winnerNick = n.winnerNick || "";
      n.winnerFinalPrice = Number(n.winnerFinalPrice || 0);
      n.closedAt = n.closedAt || "";
      n.payDueAt = Number(n.payDueAt || 0);
      n.buyerPaid = !!n.buyerPaid;
      n.sellerConfirmed = !!n.sellerConfirmed;
      n.depositHeld = (n.depositHeld === undefined) ? false : !!n.depositHeld;
      n.depositRefunded = !!n.depositRefunded;
      n.depositForfeited = !!n.depositForfeited;
      n.defaulted = !!n.defaulted;
      n.defaultedAt = n.defaultedAt || "";
      n.defaultReason = n.defaultReason || "";

      n.archived = !!n.archived;
      n.isDemo = !!n.isDemo;
      return n;
    }

    function loadProducts(){
      const tryKeys = [LS_KEY_NEW, LS_KEY_PREV, LS_KEY_OLD];
      for(const k of tryKeys){
        const raw = localStorage.getItem(k);
        if(!raw) continue;
        try{
          const parsed = JSON.parse(raw);
          if(Array.isArray(parsed)){
            const normalized = parsed.map(normalizeProduct);
            localStorage.setItem(LS_KEY_NEW, JSON.stringify(normalized));
            return normalized;
          }
        }catch(e){}
      }
      return null;
    }
    function saveProducts(){ localStorage.setItem(LS_KEY_NEW, JSON.stringify(state.products)); }

    function seedSample(){
      const base = new Date();
      const plusMin = (min)=> new Date(base.getTime() + min*60*1000);
      return [
        normalizeProduct({ id: cryptoRandomId(), title:"ì „ë™ë“œë¦´ ì„¸íŠ¸", category:"ê³µêµ¬/ì¥ë¹„", startPrice:15000, currentPrice:15000,
          endTime: plusMin(180).toISOString(), highestBidder:"", bidCount:0, createdAt: nowISO(), closed:false }),
        normalizeProduct({ id: cryptoRandomId(), title:"LG 55ì¸ì¹˜ TV (ê³ ì¥)", category:"ê°€ì „", startPrice:15000, currentPrice:15000,
          endTime: plusMin(90).toISOString(), highestBidder:"", bidCount:0, createdAt: nowISO(), closed:false }),
        normalizeProduct({ id: cryptoRandomId(), title:"ìº í•‘ í…Œì´ë¸”", category:"ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ", startPrice:15000, currentPrice:15000,
          endTime: plusMin(15).toISOString(), highestBidder:"", bidCount:0, createdAt: nowISO(), closed:false })
      ];
    }

    const state = { products: [], filterCategory: "ì „ì²´", adminEditingId: null };

    function loadFilter(){
      const raw = localStorage.getItem(LS_FILTER);
      if(raw) state.filterCategory = raw;
    }
    function saveFilter(){ localStorage.setItem(LS_FILTER, state.filterCategory); }

    /* ===== Close finalize ===== */
    function onCloseFinalize(p){
      if(p.closedAt) return;
      p.closedAt = nowISO();
      p.winnerNick = p.highestBidder || "";
      p.winnerFinalPrice = Number(p.currentPrice || p.startPrice || 0);

      const closedMs = new Date(p.closedAt).getTime();
      p.payDueAt = closedMs + RULES.nonPaymentHours * 60 * 60 * 1000;

      if(p.winnerNick){
        p.depositHeld = true;
        ledgerAdd("DEPOSIT_HELD", { productId:p.id, title:p.title, nick:p.winnerNick, amount:RULES.depositAmount, note:"ë‚™ì°° ì‹œ ë³´ì¦ê¸ˆ ì˜ˆì¹˜(ê¸°ë¡)" });
      }
    }

    function syncClosedFlags(){
      const now = Date.now();
      state.products.forEach(p=>{
        const end = new Date(p.endTime).getTime();
        if(!isNaN(end) && end <= now){
          if(!p.closed) p.closed = true;
          onCloseFinalize(p);
        }
      });
    }

    /* ===== Auto default after 48h ===== */
    function applyDefault(p){
      if(!p.closed) return;
      if(p.defaulted) return;
      if(!p.winnerNick) return;
      if(p.buyerPaid) return;
      if(!p.payDueAt) return;

      if(Date.now() > p.payDueAt){
        p.defaulted = true;
        p.defaultedAt = nowISO();
        p.defaultReason = "ë‚™ì°° í›„ 48ì‹œê°„ ë‚´ ê²°ì œì™„ë£Œ ë¯¸ì´í–‰";

        if(p.depositHeld && !p.depositForfeited && !p.depositRefunded){
          p.depositForfeited = true;
          p.depositHeld = false;
          ledgerAdd("DEPOSIT_FORFEIT", {
            productId:p.id, title:p.title, nick:p.winnerNick,
            amount:RULES.depositAmount, distribution:RULES.penalty,
            note:"ë¯¸ì´í–‰ìœ¼ë¡œ ë³´ì¦ê¸ˆ ëª°ìˆ˜(íŒë§¤ì 8,000 / í”Œë«í¼ 2,000)"
          });
        }

        const users = loadUsers();
        const u = getUser(users, p.winnerNick);
        u.strikes += 1;

        if(u.strikes >= RULES.sanctions.banAt){
          u.banned = true;
          u.suspendedUntil = 0;
        }else if(u.strikes >= RULES.sanctions.suspendAt){
          u.suspendedUntil = Date.now() + RULES.sanctions.suspendDays * 24 * 60 * 60 * 1000;
        }
        saveUsers(users);

        ledgerAdd("SANCTION", { nick:p.winnerNick, strikes:u.strikes, status:userStatusText(u), productId:p.id, title:p.title, note:"ë¯¸ì´í–‰ ì œì¬ ì ìš©" });
      }
    }

    /* ===== Buyer/Seller complete -> refund ===== */
    function maybeRefund(p){
      if(!p.buyerPaid) return;
      if(!p.sellerConfirmed) return;
      if(p.depositRefunded) return;
      if(p.depositForfeited) return;
      if(!p.winnerNick) return;

      if(p.depositHeld) p.depositHeld = false;
      p.depositRefunded = true;

      ledgerAdd("DEPOSIT_REFUND", { productId:p.id, title:p.title, nick:p.winnerNick, amount:RULES.depositAmount, note:"ê±°ë˜ì™„ë£Œ í™•ì¸ìœ¼ë¡œ ë³´ì¦ê¸ˆ í™˜ë¶ˆ" });
    }

    function markBuyerPaid(productId){
      const nick = (document.getElementById("nickname").value || "").trim();
      if(!nick){ alert("ë‹‰ë„¤ì„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”."); return; }

      const p = state.products.find(x=>x.id===productId);
      if(!p) return;
      if(!p.closed){ alert("ì•„ì§ ë§ˆê°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."); return; }
      if(!p.winnerNick){ alert("ë‚™ì°°ìê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
      if(nick !== p.winnerNick){ alert("ê²°ì œì™„ë£ŒëŠ” ë‚™ì°°ì ë‹‰ë„¤ì„ìœ¼ë¡œë§Œ ê°€ëŠ¥í•©ë‹ˆë‹¤."); return; }
      if(p.defaulted){ alert("ì´ë¯¸ ë¯¸ì´í–‰ ì²˜ë¦¬ëœ ê±´ì…ë‹ˆë‹¤."); return; }

      p.buyerPaid = true;
      ledgerAdd("BUYER_PAID", { productId:p.id, title:p.title, nick:p.winnerNick, price:p.winnerFinalPrice, note:"êµ¬ë§¤ì ê²°ì œì™„ë£Œ" });

      saveProducts();
      renderAll();
      refreshDashboard();
    }

    function markSellerConfirm(productId){
      const p = state.products.find(x=>x.id===productId);
      if(!p) return;
      if(!p.closed){ alert("ì•„ì§ ë§ˆê°ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤."); return; }
      if(!p.winnerNick){ alert("ë‚™ì°°ìê°€ ì—†ìŠµë‹ˆë‹¤."); return; }
      if(p.defaulted){ alert("ë¯¸ì´í–‰ ì²˜ë¦¬ëœ ê±´ì€ ê±°ë˜ì™„ë£Œê°€ ë¶ˆê°€í•©ë‹ˆë‹¤."); return; }

      p.sellerConfirmed = true;
      ledgerAdd("SELLER_CONFIRMED", { productId:p.id, title:p.title, nick:p.winnerNick, note:"íŒë§¤ì ê±°ë˜ì™„ë£Œ í™•ì¸" });

      maybeRefund(p);
      saveProducts();
      renderAll();
      refreshDashboard();
    }

    /* ===== ê±°ë˜ ì¢…ë£Œëœ ë§ˆê°ì¹´ë“œ ìë™ ìˆ¨ê¹€(ì•„ì¹´ì´ë¸Œ) ===== */
    function archiveFinishedClosed(p){
      if(!UI_LIMITS.HIDE_FINISHED_CLOSED) return;
      const finished = (p.depositRefunded === true) || (p.defaulted === true);
      if(p.closed && finished && !p.archived){
        p.archived = true;
        ledgerAdd("ARCHIVE", { productId:p.id, title:p.title, note:"ê±°ë˜ ì¢…ë£Œë¡œ í™”ë©´ì—ì„œ ìˆ¨ê¹€(ì•„ì¹´ì´ë¸Œ)" });
      }
    }

    /* ===== Categories ===== */
    const CATEGORIES = ["ì „ì²´","ê°€ì „","ê³µêµ¬/ì¥ë¹„","ì „ììŠ¤í¬ë©","ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ","ê±´ì„¤ ì”ì—¬ìì¬"];
    function renderCategoryBar(){
      const bar = document.getElementById("categoryBar");
      bar.innerHTML = "";
      CATEGORIES.forEach(cat=>{
        const btn = document.createElement("button");
        btn.className = "catBtn" + (state.filterCategory===cat ? " active":"");
        btn.textContent = cat;
        btn.onclick = ()=>{
          state.filterCategory = cat;
          saveFilter();
          renderAll();
        };
        bar.appendChild(btn);
      });
    }
    function passFilter(p){
      if(state.filterCategory === "ì „ì²´") return true;
      return p.category === state.filterCategory;
    }

    /* ===== Bidding ===== */
    function doBid(productId){
      const nick = (document.getElementById("nickname").value || "").trim();
      if(!nick){
        alert("ë‹‰ë„¤ì„ì„ ë¨¼ì € ì…ë ¥í•´ì£¼ì„¸ìš”.");
        document.getElementById("nickname").focus();
        return;
      }

      const users = loadUsers();
      const u = getUser(users, nick);
      const ok = canBid(u);
      if(!ok.ok){
        alert(ok.msg + `\n\ní˜„ì¬ ìƒíƒœ: ${userStatusText(u)}`);
        return;
      }
      saveUsers(users);

      const p = state.products.find(x=>x.id===productId);
      if(!p) return;

      syncClosedFlags();
      if(p.closed){
        alert("ì´ë¯¸ ë§ˆê°ëœ ìƒí’ˆì…ë‹ˆë‹¤.");
        renderAll();
        return;
      }

      const chk = document.getElementById("dep_"+productId);
      if(!chk || !chk.checked){
        alert(`ì…ì°°ë³´ì¦ê¸ˆ(${formatMoney(RULES.depositAmount)}ì›) í™•ì¸ ì²´í¬ í›„ ì…ì°°í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.\n\nì…ê¸ˆ ê³„ì¢Œ: ${DEPOSIT_ACCOUNT.bank} ${DEPOSIT_ACCOUNT.number} (${DEPOSIT_ACCOUNT.name})`);
        return;
      }

      const inc = Number(document.getElementById("incSelect").value || 1000);
      const next = Number(p.currentPrice || p.startPrice || 0) + inc;

      const endMs = new Date(p.endTime).getTime();
      const now = Date.now();
      if(!isNaN(endMs)){
        const remainSec = Math.floor((endMs - now)/1000);
        if(remainSec > 0 && remainSec <= 60){
          p.endTime = new Date(now + 60*1000).toISOString();
        }
      }

      p.currentPrice = next;
      p.highestBidder = nick;
      p.bidCount = Number(p.bidCount || 0) + 1;

      saveProducts();
      renderAll();
      refreshDashboard();
    }

    /* ===== Admin ìƒí’ˆ ===== */
    function toggleAdmin(){
      const panel = document.getElementById("adminPanel");
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    }
    function adminClear(){
      state.adminEditingId = null;
      document.getElementById("a_title").value = "";
      document.getElementById("a_category").value = "ê°€ì „";
      document.getElementById("a_startPrice").value = "";
      document.getElementById("a_endTime").value = "";
      document.getElementById("adminModeText").textContent = "í˜„ì¬: ìƒˆ ìƒí’ˆ ë“±ë¡ ëª¨ë“œ";
    }
    function adminEdit(id){
      const p = state.products.find(x=>x.id===id);
      if(!p) return;

      state.adminEditingId = id;
      document.getElementById("adminPanel").style.display = "block";
      document.getElementById("a_title").value = p.title || "";
      document.getElementById("a_category").value = p.category || "ê°€ì „";
      document.getElementById("a_startPrice").value = Number(p.startPrice || 0);
      document.getElementById("a_endTime").value = toLocalInputValue(new Date(p.endTime));
      document.getElementById("adminModeText").textContent = "í˜„ì¬: ìˆ˜ì • ëª¨ë“œ (ì €ì¥í•˜ë©´ í•´ë‹¹ ìƒí’ˆì´ ìˆ˜ì •ë©ë‹ˆë‹¤)";
      window.scrollTo({top:0, behavior:"smooth"});
    }
    function adminDelete(id){
      if(!confirm("ì •ë§ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?")) return;
      state.products = state.products.filter(x=>x.id!==id);
      saveProducts();
      renderAll();
      refreshDashboard();
    }
    function adminSave(){
      const title = (document.getElementById("a_title").value || "").trim();
      const category = document.getElementById("a_category").value;
      const startPrice = Number(document.getElementById("a_startPrice").value || 0);
      const endLocal = document.getElementById("a_endTime").value;

      if(!title){ alert("ìƒí’ˆëª…ì„ ì…ë ¥í•˜ì„¸ìš”."); return; }
      if(!startPrice || startPrice < 0){ alert("ì‹œì‘ê°€ë¥¼ ì˜¬ë°”ë¥´ê²Œ ì…ë ¥í•˜ì„¸ìš”."); return; }
      if(!endLocal){ alert("ë§ˆê°ì‹œê°„ì„ ì„ íƒí•˜ì„¸ìš”."); return; }

      const endIso = new Date(endLocal).toISOString();

      if(state.adminEditingId){
        const p = state.products.find(x=>x.id===state.adminEditingId);
        if(!p) return;

        p.title = title;
        p.category = category;
        p.startPrice = startPrice;
        if(Number(p.currentPrice || 0) < startPrice) p.currentPrice = startPrice;
        p.endTime = endIso;

        if(new Date(p.endTime).getTime() > Date.now()){
          p.closed = false;
          p.archived = false;
          p.defaulted = false;
          p.defaultReason = "";
          p.defaultedAt = "";
        }
      }else{
        state.products.unshift(normalizeProduct({
          id: cryptoRandomId(),
          title, category,
          startPrice,
          currentPrice: startPrice,
          endTime: endIso,
          highestBidder:"",
          bidCount:0,
          createdAt: nowISO(),
          closed:false,
          isDemo:false
        }));
      }

      saveProducts();
      adminClear();
      renderAll();
      refreshDashboard();
    }

    /* ===== ë°ëª¨ìš© ì§„í–‰ì¤‘ ì¹´ë“œ ìë™ ì±„ì›€(ìµœì†Œ 3ê°œ) ===== */
    const DEMO_NAMES = ["ëœë¤ ê³µêµ¬ ë°•ìŠ¤", "ì¤‘ê³  ëª¨ë‹ˆí„°(í…ŒìŠ¤íŠ¸)", "ì„ í’ê¸°(í…ŒìŠ¤íŠ¸)", "ë“œë¦´ ë°°í„°ë¦¬", "ê±´ì„¤ìì¬ ì”ëŸ‰", "ìƒí™œìš©í’ˆ ë¬¶ìŒ"];
    function pick(arr){ return arr[Math.floor(Math.random()*arr.length)]; }

    function createDemoProduct(){
      const baseMin = 20 + Math.floor(Math.random()*140);
      const end = new Date(Date.now() + baseMin*60*1000).toISOString();
      const cat = pick(["ê°€ì „","ê³µêµ¬/ì¥ë¹„","ì „ììŠ¤í¬ë©","ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ","ê±´ì„¤ ì”ì—¬ìì¬"]);
      const price = pick([12000,15000,18000,20000,25000]);

      return normalizeProduct({
        id: cryptoRandomId(),
        title: pick(DEMO_NAMES),
        category: cat,
        startPrice: price,
        currentPrice: price,
        endTime: end,
        highestBidder:"",
        bidCount:0,
        createdAt: nowISO(),
        closed:false,
        isDemo:true
      });
    }

    function ensureMinOpenCards(){
      if(!UI_LIMITS.DEMO_FILL_OPEN) return;
      const open = state.products.filter(p=>!p.closed && !p.archived);
      let need = UI_LIMITS.MIN_OPEN_CARDS - open.length;
      if(need <= 0) return;
      for(let i=0;i<need;i++) state.products.unshift(createDemoProduct());
      saveProducts();
    }

    /* ===== Render cards ===== */
    function renderCard(p){
      const remain = calcRemain(p.endTime);
      const closed = p.closed || remain.closed;

      if(closed){
        if(!p.closed) p.closed = true;
        onCloseFinalize(p);
        applyDefault(p);
        archiveFinishedClosed(p);
      }

      const card = document.createElement("div");
      card.className = "card" + (closed ? " closed":"");

      let badgeClass = closed ? "badge closed" : "badge";
      let badgeText = closed ? "ë§ˆê°" : "ì§„í–‰ì¤‘";

      if(closed && p.defaulted){
        badgeClass = "badge bad"; badgeText = "ë¯¸ì´í–‰";
      }else if(closed && p.depositRefunded){
        badgeClass = "badge good"; badgeText = "ê±°ë˜ì™„ë£Œ";
      }else if(closed && p.buyerPaid){
        badgeClass = "badge good"; badgeText = "ê²°ì œì™„ë£Œ";
      }

      const badge = document.createElement("div");
      badge.className = badgeClass;
      badge.textContent = badgeText;

      const topRow = document.createElement("div");
      topRow.className = "row";
      topRow.appendChild(badge);

      const cat = document.createElement("div");
      cat.className = "smallText";
      cat.style.fontWeight = "900";
      cat.textContent = p.category || "-";
      topRow.appendChild(cat);

      const body = document.createElement("div");
      body.className = "body";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = p.title || "-";

      const meta = document.createElement("div");
      meta.className = "meta";

      if(!closed){
        const bidderText = p.highestBidder ? `<span class="lastBidder">${escapeHtml(p.highestBidder)}</span>` : "-";
        meta.innerHTML =
          `ë§ˆê°: <span class="countdown" id="cd_${p.id}">${remain.text}</span><br>` +
          `ë§ˆê°ì‹œê°„: ${formatEndTime(p.endTime)}<br>` +
          `ì…ì°°ì: ${bidderText} / ì…ì°°íšŸìˆ˜: <b id="bc_${p.id}">${Number(p.bidCount||0)}</b>íšŒ`;
      }else{
        const winner = p.winnerNick ? `<span class="lastBidder">${escapeHtml(p.winnerNick)}</span>` : "-";
        const due = p.payDueAt ? calcRemainFromMs(p.payDueAt) : {over:false, text:"-"};
        const dueText = p.winnerNick ? (due.over ? "ê¸°í•œ ë§Œë£Œ" : due.text) : "-";
        meta.innerHTML =
          `ë§ˆê°ì‹œê°„: ${formatEndTime(p.endTime)}<br>` +
          `ë‚™ì°°ì: ${winner} / ë‚™ì°°ê°€: <b>${formatMoney(p.winnerFinalPrice || p.currentPrice || p.startPrice)}</b>ì›<br>` +
          `ê²°ì œê¸°í•œ(48H): <b id="due_${p.id}">${dueText}</b>`;
        if(p.defaulted){
          meta.innerHTML += `<br><span style="color:#b42318; font-weight:900;">ì‚¬ìœ : ${escapeHtml(p.defaultReason || "ë¯¸ì´í–‰")}</span>`;
        }
      }

      const price = document.createElement("div");
      price.className = "price";
      price.innerHTML = `í˜„ì¬ê°€: <span id="cp_${p.id}">${formatMoney(p.currentPrice || p.startPrice)}</span>ì›`;

      const divider = document.createElement("div");
      divider.className = "divider";

      const actions = document.createElement("div");
      actions.className = "actions";

      const leftBox = document.createElement("div");
      leftBox.style.display = "flex";
      leftBox.style.gap = "8px";
      leftBox.style.flexWrap = "wrap";

      const adminArea = document.createElement("div");
      adminArea.style.display="flex";
      adminArea.style.gap="8px";

      const editBtn = document.createElement("button");
      editBtn.className = "btn gray small";
      editBtn.textContent = "ìˆ˜ì •";
      editBtn.onclick = ()=>adminEdit(p.id);

      const delBtn = document.createElement("button");
      delBtn.className = "btn danger small";
      delBtn.textContent = "ì‚­ì œ";
      delBtn.onclick = ()=>adminDelete(p.id);

      adminArea.appendChild(editBtn);
      adminArea.appendChild(delBtn);

      if(!closed){
        const bidBtn = document.createElement("button");
        bidBtn.className = "btn primary";
        bidBtn.textContent = "ì…ì°°í•˜ê¸°";
        bidBtn.onclick = ()=>doBid(p.id);
        leftBox.appendChild(bidBtn);
      }else{
        const buyerPaidBtn = document.createElement("button");
        buyerPaidBtn.className = "btn primary";
        buyerPaidBtn.textContent = p.buyerPaid ? "ê²°ì œì™„ë£Œë¨" : "ê²°ì œì™„ë£Œ(êµ¬ë§¤ì)";
        buyerPaidBtn.disabled = p.buyerPaid || p.defaulted || !p.winnerNick;
        buyerPaidBtn.onclick = ()=>markBuyerPaid(p.id);

        const sellerBtn = document.createElement("button");
        sellerBtn.className = "btn soft";
        sellerBtn.textContent = p.sellerConfirmed ? "íŒë§¤ìí™•ì¸ë¨" : "ê±°ë˜ì™„ë£Œ í™•ì¸(íŒë§¤ì)";
        sellerBtn.disabled = p.sellerConfirmed || p.defaulted || !p.winnerNick;
        sellerBtn.onclick = ()=>markSellerConfirm(p.id);

        leftBox.appendChild(buyerPaidBtn);
        leftBox.appendChild(sellerBtn);
      }

      actions.appendChild(leftBox);
      actions.appendChild(adminArea);

      const bidBox = document.createElement("div");
      bidBox.className = "bidBox";

      if(!closed){
        const inc = Number(document.getElementById("incSelect").value || 1000);
        const next = Number(p.currentPrice || p.startPrice || 0) + inc;

        bidBox.innerHTML = `
          <div class="row" style="gap:10px; flex-wrap:wrap; justify-content:flex-start;">
            <label style="display:flex; align-items:center; gap:8px; font-weight:900; cursor:pointer;">
              <input type="checkbox" id="dep_${p.id}">
              ì…ì°°ë³´ì¦ê¸ˆ(${formatMoney(RULES.depositAmount)}ì›) í™•ì¸
            </label>
            <div class="smallText" style="font-weight:900;">
              ë‹¤ìŒ ì…ì°°ê°€: <span id="nb_${p.id}">${formatMoney(next)}</span>ì›
            </div>
          </div>
          <div class="bidHelp">
            â€¢ ì…ê¸ˆê³„ì¢Œ: <b>${DEPOSIT_ACCOUNT.bank} ${DEPOSIT_ACCOUNT.number}</b> (${DEPOSIT_ACCOUNT.name})<br>
            â€¢ ë‹‰ë„¤ì„ + ë³´ì¦ê¸ˆ ì²´í¬ í›„ â€œì…ì°°í•˜ê¸°â€ ëˆ„ë¥´ë©´ ìë™ ì¦ê°€í•©ë‹ˆë‹¤.<br>
            â€¢ ë§ˆê° 60ì´ˆ ì´ë‚´ ì…ì°° ì‹œ ìë™ì—°ì¥(60ì´ˆ) ì ìš©.
          </div>
        `;
      }else{
        const depositState =
          p.depositRefunded ? "í™˜ë¶ˆ ì™„ë£Œ" :
          p.depositForfeited ? "ëª°ìˆ˜(íŒë§¤ì/í”Œë«í¼ ë¶„ë°°)" :
          p.depositHeld ? "ì˜ˆì¹˜ ì¤‘" : "-";

        bidBox.innerHTML = `
          <div class="bidHelp">
            â€¢ ë³´ì¦ê¸ˆ ìƒíƒœ: <b>${depositState}</b> (ê¸ˆì•¡: ${formatMoney(RULES.depositAmount)}ì›)<br>
            â€¢ ë‚™ì°° í›„ 48ì‹œê°„ ë‚´ ê²°ì œì™„ë£Œ ì—†ìœ¼ë©´ ìë™ â€œë¯¸ì´í–‰â€ ì²˜ë¦¬ë©ë‹ˆë‹¤.<br>
            â€¢ ê±°ë˜ì™„ë£Œ(êµ¬ë§¤ì ê²°ì œì™„ë£Œ + íŒë§¤ì í™•ì¸) ì‹œ ë³´ì¦ê¸ˆ í™˜ë¶ˆ ì²˜ë¦¬(ê¸°ë¡).
          </div>
        `;
      }

      body.appendChild(topRow);
      body.appendChild(name);
      body.appendChild(meta);
      body.appendChild(price);
      body.appendChild(divider);
      body.appendChild(actions);
      body.appendChild(bidBox);

      card.appendChild(body);
      return card;
    }

    function updateNextBidLabels(){
      const inc = Number(document.getElementById("incSelect").value || 1000);
      state.products.forEach(p=>{
        const el = document.getElementById("nb_"+p.id);
        if(!el) return;
        const next = Number(p.currentPrice || p.startPrice || 0) + inc;
        el.textContent = formatMoney(next);
      });
    }

    /* ===== Summary ===== */
    const SUMMARY_CATS = [
      {key:"ê°€ì „", label:"ê°€ì „"},
      {key:"ê³µêµ¬/ì¥ë¹„", label:"ê³µêµ¬/ì¥ë¹„"},
      {key:"ì „ììŠ¤í¬ë©", label:"ì „ììŠ¤í¬ë©"},
      {key:"ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ", label:"ìƒí™œìš©í’ˆ/ë ˆì €ìš©í’ˆ"},
      {key:"ê±´ì„¤ ì”ì—¬ìì¬", label:"ê±´ì„¤ ì „ì—¬ìì¬"}
    ];

    function renderSummary(openItems){
      const grid = document.getElementById("summaryGrid");
      grid.innerHTML = "";

      SUMMARY_CATS.forEach(cat=>{
        const col = document.createElement("div");
        col.className = "sumCol";

        const t = document.createElement("div");
        t.className = "sumTitle";
        t.textContent = cat.label;

        col.appendChild(t);

        const list = openItems.filter(p=>p.category===cat.key);

        if(list.length===0){
          const empty = document.createElement("div");
          empty.className = "sumEmpty";
          empty.textContent = "ë“±ë¡ëœ ìƒí’ˆì´ ì—†ìŠµë‹ˆë‹¤.";
          col.appendChild(empty);
        }else{
          list.slice(0, 6).forEach(p=>{
            const remain = calcRemain(p.endTime);
            const box = document.createElement("div");
            box.className = "sumItem";
            box.innerHTML = `
              <div class="sumLine"><b>ìƒí’ˆëª…:</b> ${escapeHtml(p.title)}</div>
              <div class="sumLine"><b>í˜„ì¬ê°€:</b> ${formatMoney(p.currentPrice || p.startPrice)}ì›</div>
              <div class="sumLine"><b>ë‚¨ì€ì‹œê°„:</b> <span id="sum_cd_${p.id}">${remain.text}</span></div>
            `;
            col.appendChild(box);
          });
        }
        grid.appendChild(col);
      });
    }

    /* ===== Render All ===== */
    function renderAll(){
      syncClosedFlags();

      state.products.forEach(p=>{
        if(p.closed){
          applyDefault(p);
          maybeRefund(p);
          archiveFinishedClosed(p);
        }
      });

      ensureMinOpenCards();
      renderCategoryBar();

      const openGrid = document.getElementById("openGrid");
      const closedGrid = document.getElementById("closedGrid");
      openGrid.innerHTML = "";
      closedGrid.innerHTML = "";

      const visible = state.products.filter(p=>!p.archived);
      const filtered = visible.filter(passFilter);

      let open = filtered.filter(p=>!p.closed).slice(0, UI_LIMITS.MAX_OPEN_SHOW);

      let closed = filtered
        .filter(p=>p.closed)
        .slice()
        .sort((a,b)=>{
          const ta = new Date(a.closedAt || a.endTime).getTime();
          const tb = new Date(b.closedAt || b.endTime).getTime();
          return tb - ta;
        })
        .slice(0, UI_LIMITS.MAX_CLOSED_SHOW);

      if(open.length===0){
        openGrid.innerHTML = `<div class="smallText" style="padding:18px;">ì§„í–‰ì¤‘ ê²½ë§¤ê°€ ì—†ìŠµë‹ˆë‹¤.</div>`;
      }else{
        open.forEach(p=> openGrid.appendChild(renderCard(p)));
      }

      const closedSection = document.getElementById("closedSection");
      if(closed.length === 0){
        closedSection.style.display = "none";
      }else{
        closedSection.style.display = "block";
        closed.forEach(p=> closedGrid.appendChild(renderCard(p)));
      }

      const openAll = visible.filter(p=>!p.closed);
      renderSummary(openAll);

      updateNextBidLabels();
    }

    /* ===== Tick ===== */
    function tick(){
      let changed = false;

      state.products.forEach(p=>{
        const end = new Date(p.endTime).getTime();
        const wasClosed = !!p.closed;

        if(!isNaN(end) && end <= Date.now()){
          p.closed = true;
          onCloseFinalize(p);
        }

        if(p.closed){
          const beforeDefault = p.defaulted;
          applyDefault(p);
          maybeRefund(p);
          archiveFinishedClosed(p);
          if(beforeDefault !== p.defaulted) changed = true;
        }

        if(wasClosed !== p.closed) changed = true;

        const cd = document.getElementById("cd_"+p.id);
        if(cd && !p.closed) cd.textContent = calcRemain(p.endTime).text;

        const sumCd = document.getElementById("sum_cd_"+p.id);
        if(sumCd && !p.closed) sumCd.textContent = calcRemain(p.endTime).text;

        const dueEl = document.getElementById("due_"+p.id);
        if(dueEl && p.closed && p.payDueAt && !p.buyerPaid && !p.defaulted && p.winnerNick){
          const due = calcRemainFromMs(p.payDueAt);
          dueEl.textContent = due.over ? "ê¸°í•œ ë§Œë£Œ" : due.text;
        }
      });

      if(changed){
        saveProducts();
        renderAll();
        refreshDashboard();
      }
    }

    /* ===== Reset ===== */
    function resetToSample(){
      if(!confirm("ìƒ˜í”Œ ë°ì´í„°ë¡œ ì´ˆê¸°í™”í• ê¹Œìš”? (í˜„ì¬ ì €ì¥ëœ ìƒí’ˆ/ì…ì°°ì •ë³´ê°€ ì‚¬ë¼ì§‘ë‹ˆë‹¤)")) return;
      localStorage.removeItem(LS_KEY_NEW);
      localStorage.removeItem(LS_KEY_PREV);
      localStorage.removeItem(LS_KEY_OLD);
      localStorage.removeItem(LS_USERS);
      localStorage.removeItem(LS_LEDGER);
      init(true);
      refreshDashboard();
    }

    /* ===== Init ===== */
    function init(forceSeed=false){
      loadFilter();
      document.getElementById("depositAccountText").textContent =
        `${DEPOSIT_ACCOUNT.bank} ${DEPOSIT_ACCOUNT.number} (ì˜ˆê¸ˆì£¼: ${DEPOSIT_ACCOUNT.name}) / ë³´ì¦ê¸ˆ: ${formatMoney(RULES.depositAmount)}ì›`;

      const loaded = forceSeed ? null : loadProducts();
      if(loaded && loaded.length){
        state.products = loaded.map(normalizeProduct);
      }else{
        state.products = seedSample();
      }

      saveProducts();
      syncClosedFlags();
      renderAll();

      document.getElementById("incSelect").addEventListener("change", updateNextBidLabels);
    }

    /* ===== ê´€ë¦¬ì ëŒ€ì‹œë³´ë“œ(3ê°€ì§€) ===== */
    let dashTab = "trade";

    function dashBackdropClose(e){
      if(e.target && e.target.id === "dashOverlay") toggleDashboard();
    }

    function toggleDashboard(){
      const ov = document.getElementById("dashOverlay");
      const open = ov.style.display === "flex";
      ov.style.display = open ? "none" : "flex";
      if(!open) refreshDashboard();
    }

    function setDashTab(tab){
      dashTab = tab;
      document.getElementById("tab_trade").classList.toggle("active", tab==="trade");
      document.getElementById("tab_deposit").classList.toggle("active", tab==="deposit");
      document.getElementById("tab_users").classList.toggle("active", tab==="users");

      document.getElementById("dashTrade").style.display = tab==="trade" ? "block" : "none";
      document.getElementById("dashDeposit").style.display = tab==="deposit" ? "block" : "none";
      document.getElementById("dashUsers").style.display = tab==="users" ? "block" : "none";
    }

    function refreshDashboard(){
      renderDashTrade();
      renderDashDeposit();
      renderDashUsers();
      setDashTab(dashTab);
    }

    function statusLabel(p){
      if(!p.closed) return "ì§„í–‰ì¤‘";
      if(p.defaulted) return "ë¯¸ì´í–‰";
      if(p.depositRefunded) return "ê±°ë˜ì™„ë£Œ";
      if(p.buyerPaid) return "ê²°ì œì™„ë£Œ";
      return "ë§ˆê°";
    }

    function renderDashTrade(){
      const host = document.getElementById("dashTrade");
      const products = state.products.slice().filter(p=>!p.archived);

      // KPI
      const openCnt = products.filter(p=>!p.closed).length;
      const closedCnt = products.filter(p=>p.closed && !p.depositRefunded && !p.defaulted).length;
      const doneCnt = products.filter(p=>p.depositRefunded).length;
      const defCnt = products.filter(p=>p.defaulted).length;
      const demoCnt = products.filter(p=>p.isDemo && !p.closed).length;

      let html = `
        <div class="dashKpi">
          <div class="kpiCard"><div class="k">ì§„í–‰ì¤‘</div><div class="v">${openCnt}ê°œ</div></div>
          <div class="kpiCard"><div class="k">ë§ˆê°(ì²˜ë¦¬ëŒ€ê¸°)</div><div class="v">${closedCnt}ê°œ</div></div>
          <div class="kpiCard"><div class="k">ê±°ë˜ì™„ë£Œ</div><div class="v">${doneCnt}ê°œ</div></div>
          <div class="kpiCard"><div class="k">ë¯¸ì´í–‰</div><div class="v">${defCnt}ê°œ</div></div>
          <div class="kpiCard"><div class="k">ë°ëª¨ ì§„í–‰ì¤‘</div><div class="v">${demoCnt}ê°œ</div></div>
        </div>
        <div style="margin-top:14px; display:flex; gap:8px; flex-wrap:wrap; align-items:center;">
          <button class="btn gray small" onclick="dashTradeFilter('all')">ì „ì²´</button>
          <button class="btn gray small" onclick="dashTradeFilter('open')">ì§„í–‰ì¤‘</button>
          <button class="btn gray small" onclick="dashTradeFilter('closed')">ë§ˆê°(ì²˜ë¦¬ëŒ€ê¸°)</button>
          <button class="btn gray small" onclick="dashTradeFilter('done')">ê±°ë˜ì™„ë£Œ</button>
          <button class="btn gray small" onclick="dashTradeFilter('default')">ë¯¸ì´í–‰</button>
        </div>
        <div id="dashTradeList" style="margin-top:10px;"></div>
      `;
      host.innerHTML = html;

      window._dashTradeMode = window._dashTradeMode || "all";
      dashTradeFilter(window._dashTradeMode);
    }

    function dashTradeFilter(mode){
      window._dashTradeMode = mode;
      const listHost = document.getElementById("dashTradeList");
      if(!listHost) return;

      let items = state.products.slice().filter(p=>!p.archived);

      if(mode==="open") items = items.filter(p=>!p.closed);
      if(mode==="closed") items = items.filter(p=>p.closed && !p.depositRefunded && !p.defaulted);
      if(mode==="done") items = items.filter(p=>p.depositRefunded);
      if(mode==="default") items = items.filter(p=>p.defaulted);

      items = items
        .sort((a,b)=>{
          const ta = new Date(a.closedAt || a.endTime).getTime();
          const tb = new Date(b.closedAt || b.endTime).getTime();
          return tb - ta;
        })
        .slice(0, 80);

      if(items.length===0){
        listHost.innerHTML = `<div class="smallText" style="padding:10px;">í‘œì‹œí•  ë‚´ì—­ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
        return;
      }

      let html = "";
      for(const p of items){
        const st = statusLabel(p);
        const money = p.closed ? (p.winnerFinalPrice || p.currentPrice || p.startPrice) : (p.currentPrice || p.startPrice);
        const who = p.closed ? (p.winnerNick || "-") : (p.highestBidder || "-");
        const time = p.closed ? (p.closedAt ? formatEndTime(p.closedAt) : formatEndTime(p.endTime)) : formatEndTime(p.endTime);

        html += `
          <div class="dashRow">
            <div style="min-width:260px;">
              <b>${escapeHtml(p.title)}</b> <span class="smallText">(${escapeHtml(p.category)})</span><br>
              <span class="smallText">ì‹œê°„: ${escapeHtml(time)}</span>
            </div>
            <div style="min-width:200px;">
              ìƒíƒœ: <b>${escapeHtml(st)}</b><br>
              ë‹‰ë„¤ì„: <b>${escapeHtml(who)}</b>
            </div>
            <div style="min-width:160px;">
              ê¸ˆì•¡: <b>${formatMoney(money)}ì›</b><br>
              ì…ì°°: <b>${Number(p.bidCount||0)}íšŒ</b>
            </div>
            <div style="display:flex; gap:8px; flex-wrap:wrap;">
              <button class="btn gray small" onclick="adminEdit('${p.id}')">ìˆ˜ì •</button>
              <button class="btn danger small" onclick="adminDelete('${p.id}')">ì‚­ì œ</button>
            </div>
          </div>
        `;
      }
      listHost.innerHTML = html;
    }

    function renderDashDeposit(){
      const host = document.getElementById("dashDeposit");
      const ledger = loadLedger();

      let held=0, refund=0, forfeit=0, seller=0, platform=0;
      for(const l of ledger){
        if(l.type==="DEPOSIT_HELD") held += Number(l.amount||0);
        if(l.type==="DEPOSIT_REFUND") refund += Number(l.amount||0);
        if(l.type==="DEPOSIT_FORFEIT"){
          forfeit += Number(l.amount||0);
          seller += Number(l.distribution?.seller || 0);
          platform += Number(l.distribution?.platform || 0);
        }
      }

      const html = `
        <div class="dashKpi">
          <div class="kpiCard"><div class="k">ì˜ˆì¹˜(ê¸°ë¡)</div><div class="v">${formatMoney(held)}ì›</div></div>
          <div class="kpiCard"><div class="k">í™˜ë¶ˆ</div><div class="v">${formatMoney(refund)}ì›</div></div>
          <div class="kpiCard"><div class="k">ëª°ìˆ˜</div><div class="v">${formatMoney(forfeit)}ì›</div></div>
          <div class="kpiCard"><div class="k">íŒë§¤ì ì§€ê¸‰</div><div class="v">${formatMoney(seller)}ì›</div></div>
          <div class="kpiCard"><div class="k">í”Œë«í¼ ìˆ˜ìµ</div><div class="v">${formatMoney(platform)}ì›</div></div>
        </div>

        <div style="margin-top:12px;">
          <div class="smallText" style="font-weight:900;">ì…ê¸ˆ ì•ˆë‚´ ê³„ì¢Œ</div>
          <div style="margin-top:6px; padding:10px 10px; border:1px solid rgba(0,0,0,.08); border-radius:14px; background:#fafafa; font-weight:900;">
            ${DEPOSIT_ACCOUNT.bank} ${DEPOSIT_ACCOUNT.number} (ì˜ˆê¸ˆì£¼: ${DEPOSIT_ACCOUNT.name}) / ë³´ì¦ê¸ˆ: ${formatMoney(RULES.depositAmount)}ì›
          </div>
        </div>

        <div style="margin-top:14px;">
          <div class="smallText" style="font-weight:900;">ìµœê·¼ ë³´ì¦ê¸ˆ ì´ë²¤íŠ¸(ìƒìœ„ 30ê°œ)</div>
          <div style="margin-top:8px; border:1px solid rgba(0,0,0,.08); border-radius:14px; overflow:hidden;">
            ${renderLedgerRows(ledger.slice(0,30))}
          </div>
        </div>
      `;
      host.innerHTML = html;
    }

    function renderLedgerRows(items){
      if(!items || items.length===0){
        return `<div class="smallText" style="padding:10px;">ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      }
      let rows = "";
      for(const l of items){
        const at = l.at ? formatEndTime(l.at) : "-";
        let label = l.type;
        if(l.type==="DEPOSIT_HELD") label="ì˜ˆì¹˜";
        if(l.type==="DEPOSIT_REFUND") label="í™˜ë¶ˆ";
        if(l.type==="DEPOSIT_FORFEIT") label="ëª°ìˆ˜";
        if(l.type==="SANCTION") label="ì œì¬";
        if(l.type==="ARCHIVE") label="ì•„ì¹´ì´ë¸Œ";
        rows += `
          <div class="dashRow">
            <div style="min-width:150px;"><b>${escapeHtml(label)}</b><br><span class="smallText">${escapeHtml(at)}</span></div>
            <div style="min-width:260px;"><b>${escapeHtml(l.title || l.note || "-")}</b><br><span class="smallText">${escapeHtml(l.nick || "")}</span></div>
            <div style="min-width:160px;"><b>${formatMoney(l.amount||0)}ì›</b></div>
            <div class="smallText" style="flex:1;">${escapeHtml(l.note || "")}</div>
          </div>
        `;
      }
      return rows;
    }

    function renderDashUsers(){
      const host = document.getElementById("dashUsers");
      const users = loadUsers();
      const list = Object.values(users || {}).sort((a,b)=>{
        const sa = Number(a.strikes||0), sb = Number(b.strikes||0);
        return sb - sa;
      });

      let html = `
        <div class="smallText" style="font-weight:900;">ì‚¬ìš©ì ì œì¬ í˜„í™©</div>
        <div style="margin-top:10px; border:1px solid rgba(0,0,0,.08); border-radius:14px; overflow:hidden;">
      `;

      if(list.length===0){
        html += `<div class="smallText" style="padding:12px;">ë“±ë¡ëœ ì‚¬ìš©ì ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤.</div>`;
      }else{
        for(const u of list.slice(0,120)){
          const st = userStatusText(u);
          html += `
            <div class="dashRow">
              <div style="min-width:220px;">
                ë‹‰ë„¤ì„: <b>${escapeHtml(u.nick)}</b><br>
                ìƒíƒœ: <b>${escapeHtml(st)}</b>
              </div>
              <div style="min-width:180px;">
                ê²½ê³ (ëˆ„ì ): <b>${Number(u.strikes||0)}</b>
              </div>
              <div style="display:flex; gap:8px; flex-wrap:wrap;">
                <button class="btn gray small" onclick="resetUserSanction('${escapeHtml(u.nick).replaceAll("'","\\'")}')">ì´ˆê¸°í™”</button>
                <button class="btn danger small" onclick="banUser('${escapeHtml(u.nick).replaceAll("'","\\'")}')">ì˜êµ¬ì •ì§€</button>
              </div>
            </div>
          `;
        }
      }
      html += `</div>
        <div class="smallText" style="margin-top:10px;">â€» ì´ˆê¸°í™”: ê²½ê³ /ì •ì§€/ì˜êµ¬ì •ì§€ ëª¨ë‘ í•´ì œ</div>
      `;
      host.innerHTML = html;
    }

    function resetUserSanction(nick){
      const users = loadUsers();
      const u = users[nick];
      if(!u){ alert("ì‚¬ìš©ì ê¸°ë¡ì´ ì—†ìŠµë‹ˆë‹¤."); return; }
      if(!confirm(`${nick} ì‚¬ìš©ì ì œì¬ë¥¼ ì´ˆê¸°í™”í• ê¹Œìš”?`)) return;
      u.strikes = 0;
      u.suspendedUntil = 0;
      u.banned = false;
      saveUsers(users);
      refreshDashboard();
      alert("ì´ˆê¸°í™” ì™„ë£Œ");
    }

    function banUser(nick){
      const users = loadUsers();
      const u = getUser(users, nick);
      if(!confirm(`${nick} ì‚¬ìš©ìë¥¼ ì˜êµ¬ì •ì§€ ì²˜ë¦¬í• ê¹Œìš”?`)) return;
      u.banned = true;
      u.suspendedUntil = 0;
      saveUsers(users);
      ledgerAdd("SANCTION", { nick, strikes:u.strikes, status:"ì˜êµ¬ì •ì§€", note:"ê´€ë¦¬ì ìˆ˜ë™ ì˜êµ¬ì •ì§€" });
      refreshDashboard();
      alert("ì˜êµ¬ì •ì§€ ì²˜ë¦¬ ì™„ë£Œ");
    }

    /* ===== Start ===== */
    init(false);
    setInterval(tick, 1000);
  </script>
</body>
</html>
