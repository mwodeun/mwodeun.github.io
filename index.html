<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>MWODEUN 모든경매</title>
  <style>
    :root{
      --purple:#6a0dad;
      --purple2:#7c1dd1;
      --bg:#f5f5f5;
      --card:#ffffff;
      --muted:#666;
      --border:#e6e6e6;
      --dark:#101114;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", Arial, sans-serif;
      background:var(--bg);
      color:#111;
    }

    /* =========================
       상단 고정
       ========================= */
    header{
      position:sticky;
      top:0;
      z-index:50;
      background:#fff;
      border-bottom:1px solid var(--border);
    }

    /* ✅ 문제2: 배너 배경(무늬/회색원/하늘) 제거 → 흰 배경 */
    .bannerArea{
      background:#fff;
      border-bottom:1px solid rgba(0,0,0,.05);
    }

    .wrap{
      max-width:1200px;
      margin:0 auto;
      padding:12px 16px;
    }

    .topbar{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      flex-wrap:wrap;
    }

    .brand{
      display:flex;
      align-items:center;
      gap:12px;
      min-width:260px;
    }
    /* ✅ 문제1: 로고 더 키움 */
    .brand img{
      height:78px;
      width:auto;
      display:block;
      filter: drop-shadow(0 2px 2px rgba(0,0,0,.10));
    }
    .brand .title{
      font-weight:900;
      font-size:18px;
      line-height:1.1;
    }
    .brand .sub{
      font-size:12px;
      color:#1f2937;
      opacity:.85;
      margin-top:4px;
      font-weight:700;
    }

    /* ✅ 문제2: 배너 문구(가운데 정렬 + 좌→우 흐름) */
    .bannerMarquee{
      margin-top:8px;
      border:1px solid var(--border);
      border-radius:14px;
      padding:10px 12px;
      background:#fff;
      overflow:hidden;
    }
    .marqueeTrack{
      display:flex;
      width:100%;
      justify-content:center; /* 가운데 정렬 기준 */
      overflow:hidden;
    }
    .marqueeText{
      display:inline-block;
      white-space:nowrap;
      font-weight:900;
      color:#111;
      opacity:.85;
      animation: marqueeLR 14s linear infinite;
    }
    @keyframes marqueeLR{
      0%{ transform: translateX(-55%); }
      100%{ transform: translateX(55%); }
    }

    /* 상단 오른쪽 컨트롤(닉네임/자동증가/관리자버튼) */
    .controls{
      display:flex;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
      justify-content:flex-end;
      min-width:320px;
      flex:1;
    }

    .chip{
      display:flex;
      align-items:center;
      gap:8px;
      padding:8px 10px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:12px;
    }
    .chip label{
      font-size:12px;
      color:#111;
      opacity:.7;
      white-space:nowrap;
      font-weight:800;
    }
    input[type="text"], input[type="number"], input[type="datetime-local"], select{
      padding:8px 10px;
      border:1px solid rgba(0,0,0,.12);
      border-radius:12px;
      outline:none;
      background:#fff;
    }
    input[type="text"]{min-width:170px}
    select{min-width:120px}

    .btn{
      cursor:pointer;
      border:none;
      border-radius:12px;
      padding:10px 14px;
      font-weight:900;
    }
    .btn.primary{background:var(--purple); color:#fff;}
    .btn.gray{background:#eee; color:#111;}
    .btn.danger{background:#d93025; color:#fff;}
    .btn.small{padding:7px 10px; border-radius:10px; font-size:12px}

    /* ✅ 문제3: 보라색 메뉴줄 → 전부 오른쪽 정렬 */
    .primaryNav{
      background: linear-gradient(90deg, var(--purple) 0%, var(--purple2) 100%);
      border-top:1px solid rgba(255,255,255,.18);
      border-bottom:1px solid rgba(0,0,0,.18);
    }
    .primaryNav .wrap{
      padding:8px 16px;
      display:flex;
      gap:10px;
      align-items:center;
      flex-wrap:wrap;
      justify-content:flex-end;  /* ✅ 오른쪽 정렬 */
    }
    .navLink{
      color:#fff;
      text-decoration:none;
      font-weight:900;
      font-size:13px;
      padding:6px 10px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,.22);
      background:rgba(255,255,255,.08);
    }
    .navLink:hover{ background:rgba(255,255,255,.14); }

    /* 2번째 메뉴줄(카테고리): 배경색 없이 타원형 */
    .categoryRow{
      background:#fff;
      border-bottom:1px solid var(--border);
    }
    .categoryRow .wrap{
      padding:10px 16px;
      display:flex;
      gap:10px;
      flex-wrap:wrap;
      align-items:center;
    }
    .catBtn{
      cursor:pointer;
      border:1px solid var(--border);
      background:transparent;
      padding:8px 12px;
      border-radius:999px;
      font-weight:900;
      font-size:13px;
      color:#111;
    }
    .catBtn.active{
      border-color:var(--purple);
      color:var(--purple);
      box-shadow:0 0 0 3px rgba(106,13,173,.08);
    }

    /* 관리자 패널 */
    .adminPanel{
      display:none;
      margin-top:12px;
      padding:14px;
      background:#fff;
      border:1px solid rgba(0,0,0,.10);
      border-radius:16px;
      box-shadow:0 10px 22px rgba(0,0,0,.08);
    }
    .adminGrid{
      display:grid;
      grid-template-columns: 1fr 1fr;
      gap:10px;
    }
    .adminGrid .full{grid-column:1 / -1}

    /* =========================
       본문/카드(기능 유지)
       ========================= */
    main .wrap{padding:18px 16px 70px}
    h2{
      margin:24px 0 12px;
      font-size:20px;
    }
    .sectionHint{
      color:var(--muted);
      font-size:13px;
      margin-top:-6px;
      margin-bottom:14px;
    }
    .grid{
      display:flex;
      flex-wrap:wrap;
      gap:16px;
      justify-content:center;
    }
    .card{
      width:min(330px, 100%);
      background:var(--card);
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 8px 18px rgba(0,0,0,0.06);
      overflow:hidden;
      display:flex;
      flex-direction:column;
    }
    .card.closed{
      background:#e9e9e9;
      filter:grayscale(0.15);
    }
    .card .body{ padding:14px 14px 12px; }
    .row{
      display:flex;
      justify-content:space-between;
      align-items:center;
      gap:10px;
      flex-wrap:wrap;
    }
    .badge{
      font-size:12px;
      font-weight:900;
      padding:6px 10px;
      border-radius:999px;
      background:rgba(106,13,173,.1);
      color:var(--purple);
      border:1px solid rgba(106,13,173,.18);
      white-space:nowrap;
    }
    .badge.closed{
      background:rgba(0,0,0,.08);
      color:#222;
      border-color:rgba(0,0,0,.1);
    }
    .name{
      font-size:18px;
      font-weight:900;
      margin:8px 0 8px;
      word-break:keep-all;
    }
    .meta{
      font-size:13px;
      color:var(--muted);
      line-height:1.45;
    }
    .price{
      margin-top:10px;
      font-size:16px;
      font-weight:900;
    }
    .price span{color:var(--purple)}
    .divider{
      height:1px;
      background:var(--border);
      margin:12px 0;
    }
    .actions{
      display:flex;
      gap:8px;
      flex-wrap:wrap;
      align-items:center;
      justify-content:space-between;
    }
    .bidBox{
      margin-top:10px;
      padding:10px;
      border:1px dashed rgba(106,13,173,.35);
      border-radius:12px;
      background:rgba(106,13,173,.04);
    }
    .bidHelp{
      font-size:12px;
      color:var(--muted);
      margin-top:6px;
      line-height:1.35;
    }
    .smallText{font-size:12px; color:var(--muted)}
    .countdown{font-weight:900}
    .lastBidder{font-weight:900; color:#111;}

    /* =========================
       ✅ 문제4: 하단 카테고리별 목록(세로선 구분)
       ========================= */
    .summaryBox{
      margin-top:22px;
      background:#fff;
      border:1px solid var(--border);
      border-radius:16px;
      box-shadow:0 8px 18px rgba(0,0,0,0.05);
      overflow:hidden;
    }
    .summaryHead{
      padding:14px 16px;
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:10px;
      border-bottom:1px solid var(--border);
    }
    .summaryHead .ttl{
      font-size:18px;
      font-weight:900;
    }
    .summaryHead .hint{
      font-size:12px;
      color:var(--muted);
      font-weight:700;
    }
    .summaryGrid{
      display:grid;
      grid-template-columns: repeat(5, 1fr); /* 가전/공구/전자스크랩/생활용품/건설 */
    }
    .sumCol{
      padding:12px 12px 14px;
      min-height:140px;
      border-left:1px solid var(--border); /* ✅ 세로선 */
    }
    .sumCol:first-child{border-left:none;}
    .sumTitle{
      font-weight:900;
      margin-bottom:10px;
      color:#111;
    }
    .sumItem{
      padding:10px 8px;
      border:1px solid rgba(0,0,0,.06);
      border-radius:12px;
      background:#fafafa;
      margin-bottom:10px;
    }
    .sumLine{
      font-size:12px;
      color:#111;
      line-height:1.45;
    }
    .sumLine b{font-weight:900;}
    .sumEmpty{
      font-size:12px;
      color:var(--muted);
      padding:6px 2px;
      font-weight:700;
    }
    @media (max-width:980px){
      .summaryGrid{ grid-template-columns: 1fr; }
      .sumCol{ border-left:none; border-top:1px solid var(--border); }
      .sumCol:first-child{ border-top:none; }
    }

    @media (max-width:720px){
      .adminGrid{grid-template-columns:1fr}
      input[type="text"]{min-width:140px}
      .brand{min-width:auto}
      .brand img{height:68px;}
    }
  </style>
</head>

<body>
  <header>
    <!-- 배너(흰 배경) -->
    <div class="bannerArea">
      <div class="wrap">
        <div class="topbar">
          <div class="brand">
            <img src="logo.png" alt="MWODEUN 모든경매" onerror="this.style.display='none'">
            <div>
              <div class="title">MWODEUN 모든경매</div>
              <div class="sub">중고 물품만 등록 · 시작가+마감시간+자동연장</div>
            </div>
          </div>

          <div class="controls">
            <div class="chip">
              <label>닉네임</label>
              <input id="nickname" type="text" placeholder="입찰 닉네임" />
            </div>

            <div class="chip">
              <label>자동 증가</label>
              <select id="incSelect">
                <option value="1000">+1,000원</option>
                <option value="5000">+5,000원</option>
                <option value="10000">+10,000원</option>
                <option value="50000">+50,000원</option>
              </select>
            </div>

            <button class="btn primary" onclick="toggleAdmin()">관리자 상품추가</button>
            <button class="btn gray" onclick="resetToSample()" title="샘플데이터로 초기화">샘플초기화</button>
          </div>
        </div>

        <!-- ✅ 배너 문구(가운데 정렬 + 좌→우) -->
        <div class="bannerMarquee">
          <div class="marqueeTrack">
            <div class="marqueeText">
              MWODEUN 모든경매에 오신 것을 환영합니다 · 중고물품만 등록 · 입찰은 보증금 확인 후 진행 · 마감 60초 이내 입찰 시 자동연장(60초)
            </div>
          </div>
        </div>

        <div class="adminPanel" id="adminPanel">
          <div class="adminGrid">
            <div>
              <div class="smallText">상품명</div>
              <input id="a_title" type="text" placeholder="예) 캠핑 테이블" />
            </div>
            <div>
              <div class="smallText">카테고리</div>
              <select id="a_category">
                <option value="가전">가전</option>
                <option value="공구/장비">공구/장비</option>
                <option value="전자스크랩">전자스크랩</option>
                <option value="생활용품/레저용품">생활용품/레저용품</option>
                <option value="건설 잔여자재">건설 잔여자재</option>
              </select>
            </div>

            <div>
              <div class="smallText">시작가(원)</div>
              <input id="a_startPrice" type="number" min="0" placeholder="예) 15000" />
            </div>
            <div>
              <div class="smallText">마감시간</div>
              <input id="a_endTime" type="datetime-local" />
            </div>

            <div class="full" style="display:flex; gap:8px; flex-wrap:wrap; align-items:center; justify-content:flex-start; margin-top:6px;">
              <button class="btn primary" onclick="adminSave()">등록/수정 저장</button>
              <button class="btn gray" onclick="adminClear()">입력칸 비우기</button>
              <span class="smallText" id="adminModeText">현재: 새 상품 등록 모드</span>
            </div>
          </div>
        </div>

      </div>
    </div>

    <!-- 보라색 메뉴(오른쪽 정렬) -->
    <div class="primaryNav">
      <div class="wrap">
        <a class="navLink" href="#" onclick="return false;">HOME</a>
        <a class="navLink" href="#" onclick="return false;">회원가입</a>
        <a class="navLink" href="#" onclick="return false;">로그인</a>
        <a class="navLink" href="#" onclick="return false;">이용안내</a>
        <a class="navLink" href="#" onclick="return false;">고객센터</a>
      </div>
    </div>

    <!-- 카테고리(타원형) -->
    <div class="categoryRow">
      <div class="wrap" id="categoryBar"></div>
    </div>
  </header>

  <main>
    <div class="wrap">
      <h2>진행중 경매</h2>
      <div class="sectionHint">마감시간이 지나면 자동으로 “마감 카드”로 이동합니다. (LocalStorage 저장됨)</div>
      <div class="grid" id="openGrid"></div>

      <!-- 마감 상품이 0개면 숨김 -->
      <div id="closedSection" style="display:none;">
        <h2 style="margin-top:42px;">마감 카드</h2>
        <div class="sectionHint">마감된 상품만 이곳에 모입니다. (없으면 이 영역은 표시되지 않습니다)</div>
        <div class="grid" id="closedGrid"></div>
      </div>

      <!-- ✅ 문제4: 하단 카테고리별 목록(예전 방식 복구) -->
      <div class="summaryBox" id="summaryBox">
        <div class="summaryHead">
          <div class="ttl">진행중인 경매</div>
          <div class="hint">카테고리별로 “상품명 / 현재가 / 남은시간” 표시</div>
        </div>

        <div class="summaryGrid" id="summaryGrid">
          <!-- JS로 채움 -->
        </div>
      </div>

    </div>
  </main>

  <script>
    /***********************
     * LocalStorage
     ***********************/
    const LS_KEY = "mwodeun_products_final_v1";
    const LS_FILTER = "mwodeun_filter_final_v1";

    function nowISO(){ return new Date().toISOString(); }

    function toLocalInputValue(date){
      const pad = n => String(n).padStart(2,'0');
      return `${date.getFullYear()}-${pad(date.getMonth()+1)}-${pad(date.getDate())}T${pad(date.getHours())}:${pad(date.getMinutes())}`;
    }
    function formatMoney(n){ return Number(n||0).toLocaleString("ko-KR"); }

    function calcRemain(endIso){
      const end = new Date(endIso).getTime();
      const now = Date.now();
      const diff = end - now;
      if (isNaN(end)) return {closed:false, text:"시간정보 없음"};
      if (diff <= 0) return {closed:true, text:"마감"};
      const sec = Math.floor(diff/1000);
      const h = Math.floor(sec/3600);
      const m = Math.floor((sec%3600)/60);
      const s = sec%60;
      return {closed:false, text:`${h}시간 ${m}분 ${s}초`};
    }

    function formatEndTime(iso){
      const d = new Date(iso);
      if (isNaN(d.getTime())) return "시간정보 없음";
      return `${d.getFullYear()}-${String(d.getMonth()+1).padStart(2,'0')}-${String(d.getDate()).padStart(2,'0')} ` +
             `${String(d.getHours()).padStart(2,'0')}:${String(d.getMinutes()).padStart(2,'0')}`;
    }

    function loadProducts(){
      try{
        const raw = localStorage.getItem(LS_KEY);
        if(!raw) return null;
        const parsed = JSON.parse(raw);
        if(!Array.isArray(parsed)) return null;
        return parsed;
      }catch(e){ return null; }
    }
    function saveProducts(){ localStorage.setItem(LS_KEY, JSON.stringify(state.products)); }

    function cryptoRandomId(){
      return "p_" + Math.random().toString(16).slice(2) + "_" + Date.now().toString(16);
    }

    function seedSample(){
      const base = new Date();
      const plusMin = (min)=> new Date(base.getTime() + min*60*1000);
      return [
        { id: cryptoRandomId(), title:"전동드릴 세트", category:"공구/장비", startPrice:15000, currentPrice:15000,
          endTime: plusMin(180).toISOString(), highestBidder:"", bidCount:0, createdAt: nowISO(), closed:false },
        { id: cryptoRandomId(), title:"LG 55인치 TV (고장)", category:"가전", startPrice:15000, currentPrice:15000,
          endTime: plusMin(90).toISOString(), highestBidder:"", bidCount:0, createdAt: nowISO(), closed:false },
        { id: cryptoRandomId(), title:"캠핑 테이블", category:"생활용품/레저용품", startPrice:15000, currentPrice:15000,
          endTime: plusMin(15).toISOString(), highestBidder:"", bidCount:0, createdAt: nowISO(), closed:false }
      ];
    }

    const state = {
      products: [],
      filterCategory: "전체",
      adminEditingId: null
    };

    function loadFilter(){
      const raw = localStorage.getItem(LS_FILTER);
      if(raw) state.filterCategory = raw;
    }
    function saveFilter(){
      localStorage.setItem(LS_FILTER, state.filterCategory);
    }

    /***********************
     * 마감 이동
     ***********************/
    function syncClosedFlags(){
      const now = Date.now();
      state.products.forEach(p=>{
        const end = new Date(p.endTime).getTime();
        if(!isNaN(end) && end <= now) p.closed = true;
      });
    }

    /***********************
     * 카테고리
     ***********************/
    const CATEGORIES = ["전체","가전","공구/장비","전자스크랩","생활용품/레저용품","건설 잔여자재"];

    function renderCategoryBar(){
      const bar = document.getElementById("categoryBar");
      bar.innerHTML = "";
      CATEGORIES.forEach(cat=>{
        const btn = document.createElement("button");
        btn.className = "catBtn" + (state.filterCategory===cat ? " active":"");
        btn.textContent = cat;
        btn.onclick = ()=>{
          state.filterCategory = cat;
          saveFilter();
          renderAll();
        };
        bar.appendChild(btn);
      });
    }

    function passFilter(p){
      if(state.filterCategory === "전체") return true;
      return p.category === state.filterCategory;
    }

    /***********************
     * 입찰 기능(자동증가/닉네임/보증금/자동연장)
     ***********************/
    function doBid(productId){
      const nick = (document.getElementById("nickname").value || "").trim();
      if(!nick){
        alert("닉네임을 먼저 입력해주세요.");
        document.getElementById("nickname").focus();
        return;
      }

      const p = state.products.find(x=>x.id===productId);
      if(!p) return;

      syncClosedFlags();
      if(p.closed){
        alert("이미 마감된 상품입니다.");
        renderAll();
        return;
      }

      const chk = document.getElementById("dep_"+productId);
      if(!chk || !chk.checked){
        alert("입찰보증금(10,000원) 확인 체크 후 입찰할 수 있습니다.");
        return;
      }

      const inc = Number(document.getElementById("incSelect").value || 1000);
      const next = Number(p.currentPrice || p.startPrice || 0) + inc;

      // 자동연장: 마감 60초 이내 입찰 시 60초 연장
      const endMs = new Date(p.endTime).getTime();
      const now = Date.now();
      if(!isNaN(endMs)){
        const remainSec = Math.floor((endMs - now)/1000);
        if(remainSec > 0 && remainSec <= 60){
          p.endTime = new Date(now + 60*1000).toISOString();
        }
      }

      p.currentPrice = next;
      p.highestBidder = nick;
      p.bidCount = Number(p.bidCount || 0) + 1;

      saveProducts();
      renderAll();
    }

    /***********************
     * 관리자(추가/수정/삭제)
     ***********************/
    function toggleAdmin(){
      const panel = document.getElementById("adminPanel");
      panel.style.display = (panel.style.display === "block") ? "none" : "block";
    }

    function adminClear(){
      state.adminEditingId = null;
      document.getElementById("a_title").value = "";
      document.getElementById("a_category").value = "가전";
      document.getElementById("a_startPrice").value = "";
      document.getElementById("a_endTime").value = "";
      document.getElementById("adminModeText").textContent = "현재: 새 상품 등록 모드";
    }

    function adminEdit(id){
      const p = state.products.find(x=>x.id===id);
      if(!p) return;

      state.adminEditingId = id;
      document.getElementById("adminPanel").style.display = "block";
      document.getElementById("a_title").value = p.title || "";
      document.getElementById("a_category").value = p.category || "가전";
      document.getElementById("a_startPrice").value = Number(p.startPrice || 0);
      document.getElementById("a_endTime").value = toLocalInputValue(new Date(p.endTime));
      document.getElementById("adminModeText").textContent = "현재: 수정 모드 (저장하면 해당 상품이 수정됩니다)";
      window.scrollTo({top:0, behavior:"smooth"});
    }

    function adminDelete(id){
      if(!confirm("정말 삭제하시겠습니까?")) return;
      state.products = state.products.filter(x=>x.id!==id);
      saveProducts();
      renderAll();
    }

    function adminSave(){
      const title = (document.getElementById("a_title").value || "").trim();
      const category = document.getElementById("a_category").value;
      const startPrice = Number(document.getElementById("a_startPrice").value || 0);
      const endLocal = document.getElementById("a_endTime").value;

      if(!title){ alert("상품명을 입력하세요."); return; }
      if(!startPrice || startPrice < 0){ alert("시작가를 올바르게 입력하세요."); return; }
      if(!endLocal){ alert("마감시간을 선택하세요."); return; }

      const endIso = new Date(endLocal).toISOString();

      if(state.adminEditingId){
        const p = state.products.find(x=>x.id===state.adminEditingId);
        if(!p) return;

        p.title = title;
        p.category = category;
        p.startPrice = startPrice;
        if(Number(p.currentPrice || 0) < startPrice) p.currentPrice = startPrice;
        p.endTime = endIso;

        p.closed = false;
        syncClosedFlags();
      }else{
        state.products.unshift({
          id: cryptoRandomId(),
          title, category,
          startPrice,
          currentPrice: startPrice,
          endTime: endIso,
          highestBidder:"",
          bidCount:0,
          createdAt: nowISO(),
          closed:false
        });
        syncClosedFlags();
      }

      saveProducts();
      adminClear();
      renderAll();
    }

    /***********************
     * 렌더링
     ***********************/
    function escapeHtml(str){
      return String(str)
        .replaceAll("&","&amp;")
        .replaceAll("<","&lt;")
        .replaceAll(">","&gt;")
        .replaceAll('"',"&quot;")
        .replaceAll("'","&#039;");
    }

    function renderCard(p){
      const remain = calcRemain(p.endTime);
      const closed = p.closed || remain.closed;

      const card = document.createElement("div");
      card.className = "card" + (closed ? " closed":"");

      const badge = document.createElement("div");
      badge.className = "badge" + (closed ? " closed":"");
      badge.textContent = closed ? "마감" : "진행중";

      const topRow = document.createElement("div");
      topRow.className = "row";
      topRow.appendChild(badge);

      const cat = document.createElement("div");
      cat.className = "smallText";
      cat.style.fontWeight = "900";
      cat.textContent = p.category || "-";
      topRow.appendChild(cat);

      const body = document.createElement("div");
      body.className = "body";

      const name = document.createElement("div");
      name.className = "name";
      name.textContent = p.title || "-";

      const meta = document.createElement("div");
      meta.className = "meta";
      const bidderText = p.highestBidder ? `<span class="lastBidder">${escapeHtml(p.highestBidder)}</span>` : "-";
      meta.innerHTML =
        `마감: <span class="countdown" id="cd_${p.id}">${closed ? "마감" : remain.text}</span><br>` +
        `마감시간: ${formatEndTime(p.endTime)}<br>` +
        `입찰자: ${bidderText} / 입찰횟수: <b id="bc_${p.id}">${Number(p.bidCount||0)}</b>회`;

      const price = document.createElement("div");
      price.className = "price";
      price.innerHTML = `현재가: <span id="cp_${p.id}">${formatMoney(p.currentPrice || p.startPrice)}</span>원`;

      const divider = document.createElement("div");
      divider.className = "divider";

      const actions = document.createElement("div");
      actions.className = "actions";

      const bidBtn = document.createElement("button");
      bidBtn.className = "btn primary";
      bidBtn.textContent = closed ? "마감" : "입찰하기";
      bidBtn.disabled = closed;
      bidBtn.onclick = ()=>doBid(p.id);

      const adminArea = document.createElement("div");
      adminArea.style.display="flex";
      adminArea.style.gap="8px";

      const editBtn = document.createElement("button");
      editBtn.className = "btn gray small";
      editBtn.textContent = "수정";
      editBtn.onclick = ()=>adminEdit(p.id);

      const delBtn = document.createElement("button");
      delBtn.className = "btn danger small";
      delBtn.textContent = "삭제";
      delBtn.onclick = ()=>adminDelete(p.id);

      adminArea.appendChild(editBtn);
      adminArea.appendChild(delBtn);

      actions.appendChild(bidBtn);
      actions.appendChild(adminArea);

      const bidBox = document.createElement("div");
      bidBox.className = "bidBox";
      const inc = Number(document.getElementById("incSelect").value || 1000);
      const next = Number(p.currentPrice || p.startPrice || 0) + inc;

      bidBox.innerHTML = `
        <div class="row" style="gap:10px; flex-wrap:wrap; justify-content:flex-start;">
          <label style="display:flex; align-items:center; gap:8px; font-weight:900; cursor:pointer;">
            <input type="checkbox" id="dep_${p.id}">
            입찰보증금(10,000원) 확인
          </label>
          <div class="smallText" style="font-weight:900;">
            다음 입찰가: <span id="nb_${p.id}">${formatMoney(next)}</span>원
          </div>
        </div>
        <div class="bidHelp">
          • 닉네임 입력 + 보증금 체크 후 “입찰하기” 누르면 자동으로 <b>선택한 금액만큼 증가</b>합니다.<br>
          • 마감 60초 이내 입찰 시 자동연장(60초) 적용.
        </div>
      `;

      if(closed){
        setTimeout(()=>{
          const chk = document.getElementById("dep_"+p.id);
          if(chk) chk.disabled = true;
        },0);
      }

      body.appendChild(topRow);
      body.appendChild(name);
      body.appendChild(meta);
      body.appendChild(price);
      body.appendChild(divider);
      body.appendChild(actions);
      body.appendChild(bidBox);

      card.appendChild(body);
      return card;
    }

    function updateNextBidLabels(){
      const inc = Number(document.getElementById("incSelect").value || 1000);
      state.products.forEach(p=>{
        const el = document.getElementById("nb_"+p.id);
        if(!el) return;
        const next = Number(p.currentPrice || p.startPrice || 0) + inc;
        el.textContent = formatMoney(next);
      });
    }

    /* ✅ 문제4: 하단 목록 렌더 */
    const SUMMARY_CATS = [
      {key:"가전", label:"가전"},
      {key:"공구/장비", label:"공구/장비"},
      {key:"전자스크랩", label:"전자스크랩"},
      {key:"생활용품/레저용품", label:"생활용품/레저용품"},
      {key:"건설 잔여자재", label:"건설 전여자재"}
    ];

    function renderSummary(openItems){
      const grid = document.getElementById("summaryGrid");
      grid.innerHTML = "";

      SUMMARY_CATS.forEach(cat=>{
        const col = document.createElement("div");
        col.className = "sumCol";

        const t = document.createElement("div");
        t.className = "sumTitle";
        t.textContent = cat.label;

        col.appendChild(t);

        const list = openItems.filter(p=>p.category===cat.key);

        if(list.length===0){
          const empty = document.createElement("div");
          empty.className = "sumEmpty";
          empty.textContent = "등록된 상품이 없습니다.";
          col.appendChild(empty);
        }else{
          // 최신 등록 우선
          list.slice(0, 6).forEach(p=>{
            const remain = calcRemain(p.endTime);
            const box = document.createElement("div");
            box.className = "sumItem";
            box.innerHTML = `
              <div class="sumLine"><b>상품명:</b> ${escapeHtml(p.title)}</div>
              <div class="sumLine"><b>현재가:</b> ${formatMoney(p.currentPrice || p.startPrice)}원</div>
              <div class="sumLine"><b>남은시간:</b> <span id="sum_cd_${p.id}">${remain.text}</span></div>
            `;
            col.appendChild(box);
          });
        }

        grid.appendChild(col);
      });
    }

    function renderAll(){
      syncClosedFlags();
      renderCategoryBar();

      const openGrid = document.getElementById("openGrid");
      const closedGrid = document.getElementById("closedGrid");
      openGrid.innerHTML = "";
      closedGrid.innerHTML = "";

      const filtered = state.products.filter(passFilter);
      const open = filtered.filter(p=>!p.closed);
      const closed = filtered.filter(p=>p.closed);

      if(open.length===0){
        openGrid.innerHTML = `<div class="smallText" style="padding:18px;">진행중 경매가 없습니다.</div>`;
      }else{
        open.forEach(p=> openGrid.appendChild(renderCard(p)));
      }

      const closedSection = document.getElementById("closedSection");
      if(closed.length === 0){
        closedSection.style.display = "none";
      }else{
        closedSection.style.display = "block";
        closed
          .sort((a,b)=> new Date(b.endTime).getTime() - new Date(a.endTime).getTime())
          .forEach(p=> closedGrid.appendChild(renderCard(p)));
      }

      // ✅ 하단 요약 목록은 "전체 진행중(필터 무시)" 기준이 더 자연스러움:
      const openAll = state.products.filter(p=>!p.closed);
      renderSummary(openAll);

      updateNextBidLabels();
    }

    function tick(){
      let changed = false;
      const now = Date.now();

      state.products.forEach(p=>{
        const end = new Date(p.endTime).getTime();
        const wasClosed = !!p.closed;
        if(!isNaN(end) && end <= now) p.closed = true;
        if(wasClosed !== p.closed) changed = true;

        const cd = document.getElementById("cd_"+p.id);
        if(cd){
          const remain = calcRemain(p.endTime);
          cd.textContent = (p.closed || remain.closed) ? "마감" : remain.text;
        }

        // 하단 목록 남은시간 갱신
        const sumCd = document.getElementById("sum_cd_"+p.id);
        if(sumCd){
          const remain = calcRemain(p.endTime);
          sumCd.textContent = (p.closed || remain.closed) ? "마감" : remain.text;
        }
      });

      if(changed){
        saveProducts();
        renderAll();
      }
    }

    function resetToSample(){
      if(!confirm("샘플 데이터로 초기화할까요? (현재 저장된 상품/입찰정보가 사라집니다)")) return;
      localStorage.removeItem(LS_KEY);
      init();
    }

    function init(){
      loadFilter();

      const loaded = loadProducts();
      if(loaded && loaded.length){
        state.products = loaded;
      }else{
        state.products = seedSample();
        saveProducts();
      }

      syncClosedFlags();
      renderAll();

      document.getElementById("incSelect").addEventListener("change", updateNextBidLabels);
    }

    init();
    setInterval(tick, 1000);
  </script>
</body>
</html>
